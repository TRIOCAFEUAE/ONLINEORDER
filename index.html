<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Trio Cafe - Pre-Order</title>
    <!-- Use relative favicon path so it works on GitHub Pages project sites -->
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;500;700&family=Playfair+Display:wght@500;600;700&family=Noto+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Color Palette - HSL */
            --bg-color: hsl(30, 20%, 98%);
            --fg-color: hsl(25, 15%, 25%);
            --primary-color: hsl(25, 35%, 45%);
            --secondary-color: hsl(30, 25%, 90%);
            --accent-color: hsl(25, 45%, 55%);
            --border-color: hsl(30, 15%, 85%);
            --white: hsl(0, 0%, 100%);
            --error: hsl(0, 70%, 60%);
            
            /* Fonts */
            --font-body: 'DM Sans', sans-serif;
            --font-header: 'Playfair Display', serif;
            --font-arabic: 'Noto Sans Arabic', sans-serif;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-body);
            background-color: var(--bg-color);
            color: var(--fg-color);
            -webkit-font-smoothing: antialiased;
        }

        /* Layout Container */
        .app-container {
            max-width: 448px;
            margin: 0 auto;
            background-color: var(--bg-color);
            min-height: 100vh;
            position: relative;
            padding-bottom: 100px; /* Space for fixed cart */
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
        }

        /* RTL Support */
        body.rtl {
            direction: rtl;
            font-family: var(--font-arabic);
        }
        body.rtl .item-card {
            text-align: right;
        }
        body.rtl .back-btn svg {
            transform: rotate(180deg);
        }

        /* Typography */
        h1, h2, h3 {
            font-family: var(--font-header);
            margin: 0;
            font-weight: 700;
        }
        body.rtl h1, body.rtl h2, body.rtl h3 {
            font-family: var(--font-arabic);
        }

        /* Header */
        header {
            position: sticky;
            top: 0;
            background: var(--bg-color);
            z-index: 100;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-img {
            height: 32px;
            width: auto;
            object-fit: contain;
        }

        .branch-select {
            border: 1px solid var(--border-color);
            background: var(--white);
            padding: 6px 12px;
            border-radius: 6px;
            font-family: var(--font-body);
            color: var(--fg-color);
            font-size: 14px;
            outline: none;
            cursor: pointer;
        }

        .lang-toggle {
            background: none;
            border: 1px solid var(--border-color);
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 12px;
        }

        /* Tabs */
        .tabs-scroller {
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 4px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .tabs-scroller::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 8px 16px;
            margin-right: 8px;
            font-family: var(--font-body);
            font-size: 14px;
            color: var(--fg-color);
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.2s;
            opacity: 0.7;
        }
        body.rtl .tab-btn {
            margin-right: 0;
            margin-left: 8px;
            font-family: var(--font-arabic);
        }

        .tab-btn.active {
            background-color: var(--primary-color);
            color: var(--white);
            opacity: 1;
            font-weight: 500;
        }

        /* Menu List */
        .menu-list {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .item-card {
            background: var(--white);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            gap: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            border: 1px solid var(--border-color);
        }

        .item-img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            background-color: var(--secondary-color);
        }

        .item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .item-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .item-price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-price {
            font-weight: 700;
            color: var(--primary-color);
        }

        .add-btn {
            background-color: var(--secondary-color);
            border: none;
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .add-btn:active {
            background-color: var(--border-color);
        }

        /* Cart Bar */
        .cart-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 448px;
            background: var(--white);
            padding: 16px;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 200;
        }
        .cart-bar.hidden {
            display: none;
        }

        .cart-info {
            display: flex;
            flex-direction: column;
        }
        .cart-count {
            font-size: 12px;
            color: var(--fg-color);
            opacity: 0.8;
        }
        .cart-total {
            font-weight: 700;
            font-size: 18px;
            color: var(--primary-color);
        }

        .checkout-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
        }
        .checkout-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Views */
        .view {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Checkout View */
        .checkout-header {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .back-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--fg-color);
            padding: 0;
            display: flex;
            align-items: center;
        }

        .checkout-content {
            padding: 16px;
        }

        .section-card {
            background: var(--white);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .summary-total {
            border-top: 1px solid var(--border-color);
            padding-top: 12px;
            margin-top: 12px;
            font-weight: 700;
            font-size: 18px;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            font-weight: 600;
            color: var(--fg-color);
        }
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: var(--font-body);
            font-size: 16px;
            background: #FAFAFA;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: var(--white);
        }

        .card-element {
            display: flex;
            gap: 12px;
        }
        .card-element .form-group {
            flex: 1;
        }

        .place-order-btn {
            width: 100%;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            margin-top: 16px;
        }
        .place-order-btn:disabled {
            background-color: #ccc;
            cursor: wait;
        }

        /* Error View */
        .error-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 80vh;
            text-align: center;
            padding: 24px;
        }
        .error-emoji {
            font-size: 64px;
            margin-bottom: 16px;
        }
        .error-title {
            color: var(--error);
            font-size: 24px;
            margin-bottom: 12px;
        }
        .error-msg {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 24px;
            color: var(--fg-color);
        }
        .contact-info {
            background: var(--white);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            width: 100%;
        }
        .phone-link {
            display: block;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            margin: 8px 0;
            font-size: 18px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            display: none;
        }
        .loading-spinner {
            border: 4px solid var(--secondary-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div class="app-container">
        
        <!-- View 1: MENU -->
        <div id="view-menu" class="view active">
            <header>
                <div class="header-top">
                    <div class="logo-area">
                        <img src="https://drivu.s3.eu-west-1.amazonaws.com/uploads/user/image/221727/TRIO_THE-LOGO.jpg?1766490297" alt="Trio Logo" class="logo-img">
                        <select id="branch-select" class="branch-select">
                            <option value="TRIO - MIRDIF BRANCH">TRIO - MIRDIF BRANCH</option>
                            <option value="TRIO - UMM SUQEIM BRANCH">TRIO - UMM SUQEIM BRANCH</option>
                        </select>
                    </div>
                    <button id="lang-toggle" class="lang-toggle">Ø¹Ø±Ø¨ÙŠ</button>
                </div>
                <div class="tabs-scroller" id="category-tabs">
                    <!-- Tabs injected here -->
                </div>
            </header>

            <div id="menu-list" class="menu-list">
                <!-- Items injected here -->
            </div>
        </div>

        <!-- View 2: CHECKOUT -->
        <div id="view-checkout" class="view">
            <div class="checkout-header">
                <button class="back-btn" onclick="app.setView('menu')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                </button>
                <h2 id="txt-checkout-title">Checkout</h2>
            </div>
            
            <div class="checkout-content">
                <div class="section-card">
                    <h3 style="margin-bottom:12px; font-size:14px; opacity:0.7;">PICKUP FROM</h3>
                    <div id="checkout-branch" style="font-weight:700;"></div>
                </div>

                <div class="section-card" id="order-summary">
                    <!-- Order items injected here -->
                </div>

                <div class="section-card">
                    <div class="form-group">
                        <label class="form-label" id="lbl-name">Name</label>
                        <input type="text" id="inp-name" class="form-input" placeholder="Your Name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="lbl-phone">Phone Number</label>
                        <input type="tel" id="inp-phone" class="form-input" placeholder="+971 50 123 4567" required>
                    </div>
                </div>

                <div class="section-card">
                    <div class="form-group">
                        <label class="form-label" id="lbl-card">Card Number</label>
                        <input type="text" id="inp-card" class="form-input" placeholder="0000 0000 0000 0000" maxlength="19">
                    </div>
                    <div class="card-element">
                        <div class="form-group">
                            <label class="form-label" id="lbl-expiry">Expiry</label>
                            <input type="text" id="inp-expiry" class="form-input" placeholder="MM/YY" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label class="form-label" id="lbl-cvc">CVC</label>
                            <input type="text" id="inp-cvc" class="form-input" placeholder="123" maxlength="4">
                        </div>
                    </div>
                </div>

                <button id="btn-place-order" class="place-order-btn">Place Order for Pickup</button>
            </div>
        </div>

        <!-- View 3: ERROR -->
        <div id="view-error" class="view">
            <div class="error-container">
                <div class="error-emoji">ðŸ˜”</div>
                <h2 class="error-title" id="txt-error-title">We are sorry!</h2>
                <p class="error-msg" id="txt-error-msg">
                    There was a system error processing your order. Our online ordering is temporarily unavailable.
                </p>
                
                <div class="contact-info">
                    <div style="font-size:13px; opacity:0.7; margin-bottom:4px;">Umm Suqeim Branch</div>
                    <a href="tel:0568378812" class="phone-link">056 837 8812</a>
                    <div style="height:12px"></div>
                    <div style="font-size:13px; opacity:0.7; margin-bottom:4px;">Mirdif Branch</div>
                    <a href="tel:0563586000" class="phone-link">056 358 6000</a>
                </div>

                <button class="add-btn" style="background:var(--primary-color); color:white; padding:12px 24px; font-size:16px;" onclick="app.setView('menu')">
                    Back to Menu
                </button>
            </div>
        </div>

        <!-- Bottom Cart Bar -->
        <div id="cart-bar" class="cart-bar hidden">
            <div class="cart-info">
                <span class="cart-count" id="cart-count-display">0 Items</span>
                <span class="cart-total" id="cart-total-display">0 AED</span>
            </div>
            <button class="checkout-btn" id="btn-proceed" onclick="app.setView('checkout')">
                Proceed to Checkout
            </button>
        </div>

        <div id="loading" class="loading-overlay">
            <div class="loading-spinner"></div>
        </div>

    </div>

    <!-- Hidden StaticForms form -->
    <form
        id="staticforms-form"
        action="https://api.staticforms.xyz/submit"
        method="POST"
        style="display:none;"
    >
        <!-- Your StaticForms access key -->
        <input type="hidden" name="accessKey" value="sf_71agbm38lm34807m1iihkn8n" />

        <!-- Email subject line -->
        <input type="hidden" name="subject" value="New Trio Cafe Pre-order" />

        <!-- Where to send the user after submit -->
        <!-- TODO: change this to your actual GitHub Pages URL -->
        <input
            type="hidden"
            name="redirectTo"
            value="https://triocafeuae.github.io/ONLINEORDER/"
        />

        <!-- Main message body sent in the email -->
        <textarea name="message" id="staticforms-message"></textarea>
    </form>

    <script>
        // --- DATA ---
        const MENU_ITEMS = [
            { id: "1", name: { en: "Iced Matcha Latte", ar: "Ø¢ÙŠØ³ Ù…Ø§ØªØ´Ø§ Ù„Ø§ØªÙŠÙ‡" }, price: 30, category: "Most Popular", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207419/small_Ice_Matcha_Latte.jpg" },
            { id: "2", name: { en: "Flat White", ar: "ÙÙ„Ø§Øª ÙˆØ§ÙŠØª" }, price: 25, category: "Most Popular", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207422/small_Flat_White.jpg" },
            { id: "3", name: { en: "Salted Hot Chocolate", ar: "Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø³Ø§Ø®Ù†Ø© Ù…Ù…Ù„Ø­Ø©" }, price: 35, category: "Most Popular", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/213342/small_Salted_Hot_Chocolate.jpg" },
            
            { id: "4", name: { en: "Marble Blueberry Matcha", ar: "Ù…Ø§Ø±Ø¨Ù„ Ø¨Ù„ÙˆØ¨ÙŠØ±ÙŠ Ù…Ø§ØªØ´Ø§" }, price: 32, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/217616/small_Marble_Blueberry_Matcha.jpg" },
            { id: "5", name: { en: "Hot Matcha Latte", ar: "Ù…Ø§ØªØ´Ø§ Ù„Ø§ØªÙŠÙ‡ Ø³Ø§Ø®Ù†" }, price: 30, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207420/small_Hot_Matcha_Latte__1_.jpg" },
            { id: "6", name: { en: "Marble Strawberry Matcha", ar: "Ù…Ø§Ø±Ø¨Ù„ ÙØ±Ø§ÙˆÙ„Ø© Ù…Ø§ØªØ´Ø§" }, price: 32, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/209620/small_Marble_Strawberry_Matcha.jpg" },
            { id: "7", name: { en: "Marble Tropical Matcha", ar: "Ù…Ø§Ø±Ø¨Ù„ ØªØ±ÙˆØ¨ÙŠÙƒØ§Ù„ Ù…Ø§ØªØ´Ø§" }, price: 34, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/209240/small_Marble_Tropical_Matcha.jpg" },
            { id: "8", name: { en: "Malty Cereal Matcha", ar: "Ù…Ø§Ù„ØªÙŠ Ø³ÙŠØ±ÙŠØ§Ù„ Ù…Ø§ØªØ´Ø§" }, price: 31, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/208809/small_Malty_Cereal_Matcha.jpg" },
            { id: "9", name: { en: "Marble Raspberry Matcha", ar: "Ù…Ø§Ø±Ø¨Ù„ ØªÙˆØª Ø§Ù„Ø¹Ù„ÙŠÙ‚ Ù…Ø§ØªØ´Ø§" }, price: 32, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/229917/small_Marble_Raspberry_Matcha.jpg" },
            { id: "10", name: { en: "Matcha Coconut Dalgona", ar: "Ù…Ø§ØªØ´Ø§ Ø¬ÙˆØ² Ø§Ù„Ù‡Ù†Ø¯ Ø¯Ø§Ù„ØºÙˆÙ†Ø§" }, price: 33, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/208809/small_Malty_Cereal_Matcha.jpg" },
            { id: "27", name: { en: "Hibiscus", ar: "ÙƒØ±ÙƒØ¯ÙŠÙ‡" }, price: 22, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207437/small_Hibiscus.jpg" },
            { id: "28", name: { en: "Acai Smoothie", ar: "Ø¹ØµÙŠØ± Ø£ÙƒÙŠ" }, price: 30, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207440/small_Acai_Smoothie__1_.jpg" },
            { id: "29", name: { en: "Cold Chocolate", ar: "Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø¨Ø§Ø±Ø¯Ø©" }, price: 28, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207439/small_Cold_Chocolate.jpg" },
            { id: "40", name: { en: "Still Water", ar: "Ù…ÙŠØ§Ù‡ Ù…Ø¹Ø¯Ù†ÙŠØ©" }, price: 8, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/257083/small_Water.jpg" },
            
            { id: "11", name: { en: "Hot Spanish Latte", ar: "Ø³Ø¨Ø§Ù†Ø´ Ù„Ø§ØªÙŠÙ‡ Ø³Ø§Ø®Ù†" }, price: 27, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207421/small_113.jpg" },
            { id: "12", name: { en: "Hot Latte", ar: "Ù„Ø§ØªÙŠÙ‡ Ø³Ø§Ø®Ù†" }, price: 25, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207423/small_113.jpg" },
            { id: "13", name: { en: "Cappuccino", ar: "ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ" }, price: 25, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207424/small_Cappuccino__1_.jpg" },
            { id: "14", name: { en: "Cortado", ar: "ÙƒÙˆØ±ØªØ§Ø¯Ùˆ" }, price: 23, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207425/small_Cortado.jpg" },
            { id: "15", name: { en: "Spanish Cortado", ar: "Ø³Ø¨Ø§Ù†Ø´ ÙƒÙˆØ±ØªØ§Ø¯Ùˆ" }, price: 25, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207426/small_Spanish_Cortado.jpg" },
            { id: "16", name: { en: "Piccolo", ar: "Ø¨ÙŠÙƒÙˆÙ„Ùˆ" }, price: 22, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207427/small_Piccolo__1_.jpg" },
            { id: "17", name: { en: "Macchiato", ar: "Ù…Ø§ÙƒÙŠØ§ØªÙˆ" }, price: 24, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/257678/small_Macchiato__1_.jpg" },
            { id: "18", name: { en: "Hot Americano", ar: "Ø£Ù…Ø±ÙŠÙƒØ§Ù†Ùˆ Ø³Ø§Ø®Ù†" }, price: 23, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207429/small_Hot_Americano.jpg" },
            { id: "19", name: { en: "Espresso", ar: "Ø¥Ø³Ø¨Ø±ÙŠØ³Ùˆ" }, price: 23, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207431/small_Espresso.jpg" },
            { id: "20", name: { en: "Hot Long Black", ar: "Ù„ÙˆÙ†Øº Ø¨Ù„Ø§Ùƒ Ø³Ø§Ø®Ù†" }, price: 24, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207430/small_Long_Black.jpg" },
            { id: "21", name: { en: "Babychino", ar: "Ø¨ÙŠØ¨ÙŠ ØªØ´ÙŠÙ†Ùˆ" }, price: 15, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207428/small_Babyccino.jpg" },
            { id: "22", name: { en: "Iced Spanish Latte", ar: "Ø¢ÙŠØ³ Ø³Ø¨Ø§Ù†Ø´ Ù„Ø§ØªÙŠÙ‡" }, price: 28, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207432/small_Ice_Spanish_Latte.jpg" },
            { id: "23", name: { en: "Iced Latte", ar: "Ø¢ÙŠØ³ Ù„Ø§ØªÙŠÙ‡" }, price: 26, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207433/small_Ice_Latte.jpg" },
            { id: "24", name: { en: "Iced Americano", ar: "Ø¢ÙŠØ³ Ø£Ù…Ø±ÙŠÙƒØ§Ù†Ùˆ" }, price: 24, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207434/small_Ice_Americano.jpg" },
            
            { id: "25", name: { en: "Iced V60", ar: "Ø¢ÙŠØ³ V60" }, price: 28, category: "Pour Over (V60)", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207435/small_Ice_V60.jpg" },
            { id: "26", name: { en: "Hot V60", ar: "Ø³Ø§Ø®Ù† V60" }, price: 28, category: "Pour Over (V60)", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207436/small_Hot_V60.jpg" },
            
            { id: "30", name: { en: "Granola Bowl", ar: "ÙˆØ¹Ø§Ø¡ Ø§Ù„Ø¬Ø±Ø§Ù†ÙˆÙ„Ø§" }, price: 45, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/257680/small_Granola_Bowl.jpg" },
            { id: "31", name: { en: "Acai Bowl", ar: "ÙˆØ¹Ø§Ø¡ Ø£ÙƒÙŠ" }, price: 48, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/257679/small_Acai_Bowl__1_.jpg" },
            { id: "32", name: { en: "Creme Brulee Toast", ar: "ØªÙˆØ³Øª ÙƒØ±ÙŠÙ… Ø¨Ø±ÙˆÙ„ÙŠÙ‡" }, price: 42, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/227806/small_Creme_Brulee_Toast.jpg" },
            { id: "33", name: { en: "Raspberry Cheese Cake Tart", ar: "ØªØ§Ø±Øª ØªØ´ÙŠØ² ÙƒÙŠÙƒ Ø§Ù„ØªÙˆØª" }, price: 40, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207441/small_121.jpg" },
            { id: "34", name: { en: "Chocolate Cheese Toast", ar: "ØªÙˆØ³Øª Ø§Ù„Ø¬Ø¨Ù† Ø¨Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©" }, price: 38, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207443/small_Chocolate_Cheese_Toast.jpg" },
            { id: "35", name: { en: "Honeycomb Cheese Toast", ar: "ØªÙˆØ³Øª Ø§Ù„Ø¬Ø¨Ù† Ø¨Ø§Ù„Ø¹Ø³Ù„" }, price: 40, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207442/small_Honeycomb_Cheese_Toast.jpg" },
            { id: "36", name: { en: "Creme Caramel Toast", ar: "ØªÙˆØ³Øª ÙƒØ±ÙŠÙ… ÙƒØ±Ø§Ù…ÙŠÙ„" }, price: 42, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207444/small_Creme_Caramel_Toast.jpg" },
            { id: "37", name: { en: "Chocolate Peanut Tart", ar: "ØªØ§Ø±Øª Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© ÙˆØ§Ù„ÙÙˆÙ„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠ" }, price: 38, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207445/small_122.jpg" },
            { id: "38", name: { en: "Dates Cheese Toast", ar: "ØªÙˆØ³Øª Ø§Ù„Ø¬Ø¨Ù† Ø¨Ø§Ù„ØªÙ…Ø±" }, price: 39, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207446/small_Dates___Cheese_Toast__1_.jpg" },
            { id: "39", name: { en: "Salted Caramel Tart", ar: "ØªØ§Ø±Øª Ø§Ù„ÙƒØ±Ø§Ù…ÙŠÙ„ Ø§Ù„Ù…Ù…Ù„Ø­" }, price: 41, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207447/small_123.jpg" },
        ];

        const CATEGORIES = [
            "Most Popular", 
            "Espresso Based", 
            "Signature Drinks", 
            "Pour Over (V60)", 
            "Desserts & Toasts"
        ];

        const TRANSLATIONS = {
            en: {
                "Add": "Add",
                "Checkout": "Checkout",
                "Items": "Items",
                "AED": "AED",
                "Proceed": "Proceed to Checkout",
                "PickupFrom": "PICKUP FROM",
                "Total": "TOTAL",
                "Name": "Name",
                "Phone": "Phone Number",
                "CardNum": "Card Number",
                "Expiry": "Expiry",
                "CVC": "CVC",
                "PlaceOrder": "Place Order for Pickup",
                "Sorry": "We are sorry!",
                "ErrorMsg": "There was a system error processing your order. Our online ordering is temporarily unavailable.",
                "Back": "Back to Menu",
                "Most Popular": "Most Popular",
                "Espresso Based": "Espresso Based",
                "Signature Drinks": "Signature Drinks",
                "Pour Over (V60)": "Pour Over (V60)",
                "Desserts & Toasts": "Desserts & Toasts"
            },
            ar: {
                "Add": "Ø£Ø¶Ù",
                "Checkout": "Ø§Ù„Ø¯ÙØ¹",
                "Items": "Ø¹Ù†Ø§ØµØ±",
                "AED": "Ø¯Ø±Ù‡Ù…",
                "Proceed": "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨",
                "PickupFrom": "Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù†",
                "Total": "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",
                "Name": "Ø§Ù„Ø§Ø³Ù…",
                "Phone": "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ",
                "CardNum": "Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©",
                "Expiry": "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡",
                "CVC": "Ø±Ù…Ø² Ø§Ù„Ø£Ù…Ø§Ù†",
                "PlaceOrder": "ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…",
                "Sorry": "Ù†Ø­Ù† Ù†Ø¹ØªØ°Ø±!",
                "ErrorMsg": "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ. Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ØºÙŠØ± Ù…ØªØ§Ø­ Ù…Ø¤Ù‚ØªÙ‹Ø§. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ÙØ±Ø¹.",
                "Back": "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©",
                "Most Popular": "Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹",
                "Espresso Based": "Ø¥Ø³Ø¨Ø±ÙŠØ³Ùˆ",
                "Signature Drinks": "Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø®Ø§ØµØ©",
                "Pour Over (V60)": "Ù‚Ù‡ÙˆØ© Ù…Ù‚Ø·Ø±Ø©",
                "Desserts & Toasts": "Ø­Ù„ÙˆÙŠØ§Øª ÙˆØªÙˆØ³Øª"
            }
        };

        // --- APP LOGIC ---
        const app = {
            state: {
                lang: 'en',
                branch: 'TRIO - MIRDIF BRANCH',
                cart: {}, // { id: quantity }
                activeCategory: 'Most Popular',
                currentView: 'menu'
            },

            init() {
                this.renderTabs();
                this.renderMenu();
                
                // Event Listeners
                document.getElementById('branch-select').addEventListener('change', (e) => {
                    this.state.branch = e.target.value;
                    this.renderCheckout(); // Update checkout branch display
                });

                document.getElementById('lang-toggle').addEventListener('click', () => {
                    this.toggleLang();
                });

                // Input Formatters
                this.setupInputFormatters();
                
                // Place Order
                document.getElementById('btn-place-order').addEventListener('click', () => {
                    this.submitOrder();
                });
            },

            toggleLang() {
                this.state.lang = this.state.lang === 'en' ? 'ar' : 'en';
                const isRtl = this.state.lang === 'ar';
                document.body.classList.toggle('rtl', isRtl);
                document.getElementById('lang-toggle').textContent = isRtl ? 'English' : 'Ø¹Ø±Ø¨ÙŠ';
                
                this.updateText();
                this.renderTabs(); // Re-render to translate categories
                this.renderMenu(); // Re-render to translate items
                this.renderCheckout();
            },

            updateText() {
                const t = TRANSLATIONS[this.state.lang];
                document.querySelectorAll('[data-trans]').forEach(el => {
                    const key = el.dataset.trans;
                    if (t[key]) el.textContent = t[key];
                });

                // Manual updates
                document.getElementById('btn-proceed').textContent = t.Proceed;
                document.getElementById('txt-checkout-title').textContent = t.Checkout;
                document.getElementById('lbl-name').textContent = t.Name;
                document.getElementById('lbl-phone').textContent = t.Phone;
                document.getElementById('lbl-card').textContent = t.CardNum;
                document.getElementById('lbl-expiry').textContent = t.Expiry;
                document.getElementById('lbl-cvc').textContent = t.CVC;
                document.getElementById('btn-place-order').textContent = t.PlaceOrder;
                document.getElementById('txt-error-title').textContent = t.Sorry;
                document.getElementById('txt-error-msg').textContent = t.ErrorMsg;
            },

            renderTabs() {
                const container = document.getElementById('category-tabs');
                container.innerHTML = '';
                const t = TRANSLATIONS[this.state.lang];

                CATEGORIES.forEach(cat => {
                    const btn = document.createElement('button');
                    btn.className = `tab-btn ${cat === this.state.activeCategory ? 'active' : ''}`;
                    // Translate category if possible, else fallback
                    btn.textContent = t[cat] || cat;
                    btn.onclick = () => {
                        this.state.activeCategory = cat;
                        this.renderTabs();
                        this.renderMenu();
                    };
                    container.appendChild(btn);
                });
            },

            renderMenu() {
                const container = document.getElementById('menu-list');
                container.innerHTML = '';
                const items = MENU_ITEMS.filter(i => i.category === this.state.activeCategory);
                const t = TRANSLATIONS[this.state.lang];

                items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    
                    const name = this.state.lang === 'ar' && item.name.ar ? item.name.ar : item.name.en;
                    const price = `${item.price} ${t.AED}`;
                    
                    card.innerHTML = `
                        <img src="${item.image}" alt="${name}" class="item-img" loading="lazy">
                        <div class="item-details">
                            <div class="item-name">${name}</div>
                            <div class="item-price-row">
                                <span class="item-price">${price}</span>
                                <button class="add-btn" onclick="app.addToCart('${item.id}')">${t.Add}</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            },

            addToCart(id) {
                if (!this.state.cart[id]) this.state.cart[id] = 0;
                this.state.cart[id]++;
                this.updateCartBar();
            },

            updateCartBar() {
                const totalItems = Object.values(this.state.cart).reduce((a, b) => a + b, 0);
                const totalPrice = Object.entries(this.state.cart).reduce((acc, [id, qty]) => {
                    const item = MENU_ITEMS.find(i => i.id === id);
                    return acc + (item.price * qty);
                }, 0);

                const bar = document.getElementById('cart-bar');
                const t = TRANSLATIONS[this.state.lang];

                if (totalItems > 0) {
                    bar.classList.remove('hidden');
                    document.getElementById('cart-count-display').textContent = `${totalItems} ${t.Items}`;
                    document.getElementById('cart-total-display').textContent = `${totalPrice} ${t.AED}`;
                } else {
                    bar.classList.add('hidden');
                }
            },

            setView(viewName) {
                this.state.currentView = viewName;
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.getElementById(`view-${viewName}`).classList.add('active');

                // Toggle cart bar visibility logic
                const bar = document.getElementById('cart-bar');
                if (viewName === 'menu') {
                    this.updateCartBar(); // Show if items exist
                } else {
                    bar.classList.add('hidden'); // Hide on checkout/error
                }

                if (viewName === 'checkout') {
                    this.renderCheckout();
                }

                window.scrollTo(0, 0);
            },

            renderCheckout() {
                document.getElementById('checkout-branch').textContent = this.state.branch;
                const container = document.getElementById('order-summary');
                container.innerHTML = '';
                const t = TRANSLATIONS[this.state.lang];
                
                let total = 0;

                Object.entries(this.state.cart).forEach(([id, qty]) => {
                    if (qty > 0) {
                        const item = MENU_ITEMS.find(i => i.id === id);
                        const name = this.state.lang === 'ar' && item.name.ar ? item.name.ar : item.name.en;
                        const lineTotal = item.price * qty;
                        total += lineTotal;

                        const row = document.createElement('div');
                        row.className = 'summary-row';
                        row.innerHTML = `
                            <span>${qty}x ${name}</span>
                            <span>${lineTotal} ${t.AED}</span>
                        `;
                        container.appendChild(row);
                    }
                });

                const totalRow = document.createElement('div');
                totalRow.className = 'summary-row summary-total';
                totalRow.innerHTML = `
                    <span>${t.Total}</span>
                    <span>${total} ${t.AED}</span>
                `;
                container.appendChild(totalRow);
            },

            setupInputFormatters() {
                // Card Number Spacing
                const cardInput = document.getElementById('inp-card');
                cardInput.addEventListener('input', (e) => {
                    let v = e.target.value.replace(/\D/g, '').substring(0, 16);
                    let matches = v.match(/\d{4,16}/g);
                    let match = (matches && matches[0]) || '';
                    let parts = [];
                    for (let i = 0, len = match.length; i < len; i += 4) {
                        parts.push(match.substring(i, i + 4));
                    }
                    if (parts.length) {
                        e.target.value = parts.join(' ');
                    } else {
                        e.target.value = v;
                    }
                });

                // Expiry Date Slash
                const expInput = document.getElementById('inp-expiry');
                expInput.addEventListener('input', (e) => {
                    let v = e.target.value.replace(/\D/g, '').substring(0, 4);
                    if (v.length >= 2) {
                        e.target.value = v.substring(0, 2) + '/' + v.substring(2);
                    } else {
                        e.target.value = v;
                    }
                });

                // CVC Numbers only
                const cvcInput = document.getElementById('inp-cvc');
                cvcInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '').substring(0, 4);
                });
            },

            async submitOrder() {
                const name = document.getElementById('inp-name').value;
                const phone = document.getElementById('inp-phone').value;
                
                if (!name || !phone) {
                    alert(this.state.lang === 'en'
                        ? 'Please fill in Name and Phone'
                        : 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ');
                    return;
                }

                // NOTE: For real payments, you should NOT send card data via email.
                // This is only for demo purposes.
                const cardNumber = document.getElementById('inp-card').value;
                const expiry = document.getElementById('inp-expiry').value;
                const cvc = document.getElementById('inp-cvc').value;

                document.getElementById('loading').style.display = 'flex';

                // Calculate Total & Items
                let total = 0;
                let itemsList = [];
                Object.entries(this.state.cart).forEach(([id, qty]) => {
                    if (qty > 0) {
                        const item = MENU_ITEMS.find(i => i.id === id);
                        const nameEn = item.name.en;
                        total += item.price * qty;
                        itemsList.push(`${qty}x ${nameEn}`);
                    }
                });

                const messageLines = [
                    `New Trio Cafe pre-order`,
                    ``,
                    `Name: ${name}`,
                    `Phone: ${phone}`,
                    `Branch: ${this.state.branch}`,
                    ``,
                    `Items:`,
                    ...itemsList.map(line => `- ${line}`),
                    ``,
                    `Total: ${total} AED`,
                    ``,
                    `Payment details (for demo only):`,
                    `Card: ${cardNumber}`,
                    `Expiry: ${expiry}`,
                    `CVC: ${cvc}`
                ];

                const message = messageLines.join('\n');

                // Fill the hidden StaticForms <textarea>
                const msgField = document.getElementById('staticforms-message');
                msgField.value = message;

                try {
                    // Clear cart locally before redirect
                    this.state.cart = {};
                    this.updateCartBar();

                    // Submit the hidden StaticForms form
                    document.getElementById('staticforms-form').submit();
                    // Browser will navigate to redirectTo after this.
                } catch (e) {
                    console.error(e);
                    alert(this.state.lang === 'en'
                        ? 'There was an error submitting your order. Please call the branch.'
                        : 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ÙØ±Ø¹.');
                } finally {
                    // May not run if navigation happens immediately, but it's fine.
                    document.getElementById('loading').style.display = 'none';
                }
            }
        };

        // Initialize App
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
