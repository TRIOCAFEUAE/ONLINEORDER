<!DOCTYPE html>
<html lang="en">
<head>
  <script type="module">
import { createHotContext } from "/@vite/client";
const hot = createHotContext("/__dummy__runtime-error-plugin");

function sendError(error) {
  if (!(error instanceof Error)) {
    error = new Error("(unknown runtime error)");
  }
  const serialized = {
    message: error.message,
    stack: error.stack,
  };
  hot.send("runtime-error-plugin:error", serialized);
}

window.addEventListener("error", (evt) => {
  sendError(evt.error);
});

window.addEventListener("unhandledrejection", (evt) => {
  sendError(evt.reason);
});
</script>

  <script type="module">import { injectIntoGlobalHook } from "/@react-refresh";
injectIntoGlobalHook(window);
window.$RefreshReg$ = () => {};
window.$RefreshSig$ = () => (type) => type;</script>

  <script type="module" src="/@vite/client"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Trio Cafe - Pre-Order</title>
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;500;700&family=Playfair+Display:wght@500;600;700&family=Noto+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Color Palette - HSL */
            --bg-color: hsl(30, 20%, 98%);
            --fg-color: hsl(25, 15%, 25%);
            --primary-color: hsl(25, 35%, 45%);
            --secondary-color: hsl(30, 25%, 90%);
            --accent-color: hsl(25, 45%, 55%);
            --border-color: hsl(30, 15%, 85%);
            --white: hsl(0, 0%, 100%);
            --error: hsl(0, 70%, 60%);
            
            /* Fonts */
            --font-body: 'DM Sans', sans-serif;
            --font-header: 'Playfair Display', serif;
            --font-arabic: 'Noto Sans Arabic', sans-serif;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-body);
            background-color: var(--bg-color);
            color: var(--fg-color);
            -webkit-font-smoothing: antialiased;
        }

        /* Layout Container */
        .app-container {
            max-width: 448px;
            margin: 0 auto;
            background-color: var(--bg-color);
            min-height: 100vh;
            position: relative;
            padding-bottom: 100px; /* Space for fixed cart */
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
        }

        /* RTL Support */
        body.rtl {
            direction: rtl;
            font-family: var(--font-arabic);
        }
        body.rtl .item-card {
            text-align: right;
        }
        body.rtl .back-btn svg {
            transform: rotate(180deg);
        }

        /* Typography */
        h1, h2, h3 {
            font-family: var(--font-header);
            margin: 0;
            font-weight: 700;
        }
        body.rtl h1, body.rtl h2, body.rtl h3 {
            font-family: var(--font-arabic);
        }

        /* Header */
        header {
            position: sticky;
            top: 0;
            background: var(--bg-color);
            z-index: 100;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-img {
            height: 32px;
            width: auto;
            -o-object-fit: contain;
               object-fit: contain;
        }

        .branch-select {
            border: 1px solid var(--border-color);
            background: var(--white);
            padding: 6px 12px;
            border-radius: 6px;
            font-family: var(--font-body);
            color: var(--fg-color);
            font-size: 14px;
            outline: none;
            cursor: pointer;
        }

        .lang-toggle {
            background: none;
            border: 1px solid var(--border-color);
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 12px;
        }

        /* Tabs */
        .tabs-scroller {
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 4px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .tabs-scroller::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 8px 16px;
            margin-right: 8px;
            font-family: var(--font-body);
            font-size: 14px;
            color: var(--fg-color);
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.2s;
            opacity: 0.7;
        }
        body.rtl .tab-btn {
            margin-right: 0;
            margin-left: 8px;
            font-family: var(--font-arabic);
        }

        .tab-btn.active {
            background-color: var(--primary-color);
            color: var(--white);
            opacity: 1;
            font-weight: 500;
        }

        /* Menu List */
        .menu-list {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .item-card {
            background: var(--white);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            gap: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            border: 1px solid var(--border-color);
        }

        .item-img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            -o-object-fit: cover;
               object-fit: cover;
            background-color: var(--secondary-color);
        }

        .item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .item-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .item-price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-price {
            font-weight: 700;
            color: var(--primary-color);
        }

        .add-btn {
            background-color: var(--secondary-color);
            border: none;
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .add-btn:active {
            background-color: var(--border-color);
        }

        /* Cart Bar */
        .cart-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 448px;
            background: var(--white);
            padding: 16px;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 200;
        }
        .cart-bar.hidden {
            display: none;
        }

        .cart-info {
            display: flex;
            flex-direction: column;
        }
        .cart-count {
            font-size: 12px;
            color: var(--fg-color);
            opacity: 0.8;
        }
        .cart-total {
            font-weight: 700;
            font-size: 18px;
            color: var(--primary-color);
        }

        .checkout-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
        }
        .checkout-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Views */
        .view {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Checkout View */
        .checkout-header {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .back-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--fg-color);
            padding: 0;
            display: flex;
            align-items: center;
        }

        .checkout-content {
            padding: 16px;
        }

        .section-card {
            background: var(--white);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .summary-total {
            border-top: 1px solid var(--border-color);
            padding-top: 12px;
            margin-top: 12px;
            font-weight: 700;
            font-size: 18px;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            font-weight: 600;
            color: var(--fg-color);
        }
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: var(--font-body);
            font-size: 16px;
            background: #FAFAFA;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: var(--white);
        }

        .card-element {
            display: flex;
            gap: 12px;
        }
        .card-element .form-group {
            flex: 1;
        }

        .place-order-btn {
            width: 100%;
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            margin-top: 16px;
        }
        .place-order-btn:disabled {
            background-color: #ccc;
            cursor: wait;
        }

        /* Error View */
        .error-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 80vh;
            text-align: center;
            padding: 24px;
        }
        .error-emoji {
            font-size: 64px;
            margin-bottom: 16px;
        }
        .error-title {
            color: var(--error);
            font-size: 24px;
            margin-bottom: 12px;
        }
        .error-msg {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 24px;
            color: var(--fg-color);
        }
        .contact-info {
            background: var(--white);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            width: 100%;
        }
        .phone-link {
            display: block;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            margin: 8px 0;
            font-size: 18px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            display: none;
        }
        .loading-spinner {
            border: 4px solid var(--secondary-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
  <script type="module">"use strict";(()=>{var P="0.4.4";var v={HIGHLIGHT_COLOR:"#0079F2",HIGHLIGHT_BG:"#0079F210",ALLOWED_DOMAIN:".replit.dev",THEME_PREVIEW_STYLE_ID:"replit-theme-preview",MAX_SIBLING_HIGHLIGHTERS:1e3,MAX_DESCENDANTS_FOR_SCREENSHOT:1500},Z=`
  [contenteditable] {
    outline: none !important;
  }

  [contenteditable]:focus {
    outline: none !important;
  }
`,ee=`
  .beacon-highlighter {
    content: '';
    position: absolute;
    z-index: ${Number.MAX_SAFE_INTEGER-3};
    box-sizing: border-box;
    pointer-events: none;
    outline: 2px dashed ${v.HIGHLIGHT_COLOR} !important;
    outline-offset: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    transform: none !important;
    background: ${v.HIGHLIGHT_BG} !important;
    opacity: 0;
  }
  
  .beacon-hover-highlighter {
    position: fixed;
    z-index: ${Number.MAX_SAFE_INTEGER};
  }
  
  .beacon-selected-highlighter {
    position: fixed;
    pointer-events: none;
    outline: 2px solid ${v.HIGHLIGHT_COLOR} !important;
    outline-offset: 3px !important;
    background: none !important;
  }
  
  .beacon-label {
    position: absolute;
    background-color: ${v.HIGHLIGHT_COLOR};
    color: #FFFFFF;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 14px;
    font-family: monospace;
    line-height: 1;
    white-space: nowrap;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transform: translateY(-100%);
    margin-top: -4px;
    left: 0;
    z-index: ${Number.MAX_SAFE_INTEGER-2};
    pointer-events: none;
    opacity: 0;
  }
  
  .beacon-hover-label {
    position: fixed;
    z-index: ${Number.MAX_SAFE_INTEGER};
  }
  
  .beacon-selected-label {
    position: fixed;
    pointer-events: none;
  }
  
  .beacon-sibling-highlighter {
    position: fixed;
    pointer-events: none;
    outline: 2px dashed ${v.HIGHLIGHT_COLOR} !important;
    outline-offset: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    transform: none !important;
    background: ${v.HIGHLIGHT_BG} !important;
  }
`;function Me(e,i){return e[13]=1,e[14]=i>>8,e[15]=i&255,e[16]=i>>8,e[17]=i&255,e}var le=112,ae=72,ce=89,he=115,G;function Re(){let e=new Int32Array(256);for(let i=0;i<256;i++){let t=i;for(let n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;e[i]=t}return e}function De(e){let i=-1;G||(G=Re());for(let t=0;t<e.length;t++)i=G[(i^e[t])&255]^i>>>8;return i^-1}function Oe(e){let i=e.length-1;for(let t=i;t>=4;t--)if(e[t-4]===9&&e[t-3]===le&&e[t-2]===ae&&e[t-1]===ce&&e[t]===he)return t-3;return 0}function Pe(e,i,t=!1){let n=new Uint8Array(13);i*=39.3701,n[0]=le,n[1]=ae,n[2]=ce,n[3]=he,n[4]=i>>>24,n[5]=i>>>16,n[6]=i>>>8,n[7]=i&255,n[8]=n[4],n[9]=n[5],n[10]=n[6],n[11]=n[7],n[12]=1;let s=De(n),r=new Uint8Array(4);if(r[0]=s>>>24,r[1]=s>>>16,r[2]=s>>>8,r[3]=s&255,t){let l=Oe(e);return e.set(n,l),e.set(r,l+13),e}else{let l=new Uint8Array(4);l[0]=0,l[1]=0,l[2]=0,l[3]=9;let o=new Uint8Array(54);return o.set(e,0),o.set(l,33),o.set(n,37),o.set(r,50),o}}var de="[modern-screenshot]",H=typeof window<"u",Fe=H&&"Worker"in window,ke=H&&"atob"in window,Yt=H&&"btoa"in window,V=H?window.navigator?.userAgent:"",ue=V.includes("Chrome"),F=V.includes("AppleWebKit")&&!ue,j=V.includes("Firefox"),Ue=e=>e&&"__CONTEXT__"in e,$e=e=>e.constructor.name==="CSSFontFaceRule",Be=e=>e.constructor.name==="CSSImportRule",S=e=>e.nodeType===1,N=e=>typeof e.className=="object",ge=e=>e.tagName==="image",Ge=e=>e.tagName==="use",x=e=>S(e)&&typeof e.style<"u"&&!N(e),We=e=>e.nodeType===8,Ve=e=>e.nodeType===3,L=e=>e.tagName==="IMG",k=e=>e.tagName==="VIDEO",je=e=>e.tagName==="CANVAS",qe=e=>e.tagName==="TEXTAREA",ze=e=>e.tagName==="INPUT",Xe=e=>e.tagName==="STYLE",Ye=e=>e.tagName==="SCRIPT",Ke=e=>e.tagName==="SELECT",Je=e=>e.tagName==="SLOT",Qe=e=>e.tagName==="IFRAME",Ze=(...e)=>console.warn(de,...e);function et(e){let i=e?.createElement?.("canvas");return i&&(i.height=i.width=1),!!i&&"toDataURL"in i&&!!i.toDataURL("image/webp").includes("image/webp")}var W=e=>e.startsWith("data:");function me(e,i){if(e.match(/^[a-z]+:\/\//i))return e;if(H&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!H)return e;let t=U().implementation.createHTMLDocument(),n=t.createElement("base"),s=t.createElement("a");return t.head.appendChild(n),t.body.appendChild(s),i&&(n.href=i),s.href=e,s.href}function U(e){return(e&&S(e)?e?.ownerDocument:e)??window.document}var $="http://www.w3.org/2000/svg";function tt(e,i,t){let n=U(t).createElementNS($,"svg");return n.setAttributeNS(null,"width",e.toString()),n.setAttributeNS(null,"height",i.toString()),n.setAttributeNS(null,"viewBox",`0 0 ${e} ${i}`),n}function it(e,i){let t=new XMLSerializer().serializeToString(e);return i&&(t=t.replace(/[\u0000-\u0008\v\f\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`}async function nt(e,i="image/png",t=1){try{return await new Promise((n,s)=>{e.toBlob(r=>{r?n(r):s(new Error("Blob is null"))},i,t)})}catch(n){if(ke)return rt(e.toDataURL(i,t));throw n}}function rt(e){let[i,t]=e.split(","),n=i.match(/data:(.+);/)?.[1]??void 0,s=window.atob(t),r=s.length,l=new Uint8Array(r);for(let o=0;o<r;o+=1)l[o]=s.charCodeAt(o);return new Blob([l],{type:n})}function fe(e,i){return new Promise((t,n)=>{let s=new FileReader;s.onload=()=>t(s.result),s.onerror=()=>n(s.error),s.onabort=()=>n(new Error(`Failed read blob to ${i}`)),i==="dataUrl"?s.readAsDataURL(e):i==="arrayBuffer"&&s.readAsArrayBuffer(e)})}var st=e=>fe(e,"dataUrl"),ot=e=>fe(e,"arrayBuffer");function C(e,i){let t=U(i).createElement("img");return t.decoding="sync",t.loading="eager",t.src=e,t}function _(e,i){return new Promise(t=>{let{timeout:n,ownerDocument:s,onError:r,onWarn:l}=i??{},o=typeof e=="string"?C(e,U(s)):e,c=null,h=null;function a(){t(o),c&&clearTimeout(c),h?.()}if(n&&(c=setTimeout(a,n)),k(o)){let d=o.currentSrc||o.src;if(!d)return o.poster?_(o.poster,i).then(t):a();if(o.readyState>=2)return a();let u=a,m=g=>{l?.("Failed video load",d,g),r?.(g),a()};h=()=>{o.removeEventListener("loadeddata",u),o.removeEventListener("error",m)},o.addEventListener("loadeddata",u,{once:!0}),o.addEventListener("error",m,{once:!0})}else{let d=ge(o)?o.href.baseVal:o.currentSrc||o.src;if(!d)return a();let u=async()=>{if(L(o)&&"decode"in o)try{await o.decode()}catch(g){l?.("Failed to decode image, trying to render anyway",o.dataset.originalSrc||d,g)}a()},m=g=>{l?.("Failed image load",o.dataset.originalSrc||d,g),a()};if(L(o)&&o.complete)return u();h=()=>{o.removeEventListener("load",u),o.removeEventListener("error",m)},o.addEventListener("load",u,{once:!0}),o.addEventListener("error",m,{once:!0})}})}async function lt(e,i){x(e)&&(L(e)||k(e)?await _(e,i):await Promise.all(["img","video"].flatMap(t=>Array.from(e.querySelectorAll(t)).map(n=>_(n,i)))))}var pe=function(){let i=0,t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(i+=1,`u${t()}${i}`)}();function be(e){return e?.split(",").map(i=>i.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}var te=0;function at(e){let i=`${de}[#${te}]`;return te++,{time:t=>e&&console.time(`${i} ${t}`),timeEnd:t=>e&&console.timeEnd(`${i} ${t}`),warn:(...t)=>e&&Ze(...t)}}function ct(e){return{cache:e?"no-cache":"force-cache"}}async function q(e,i){return Ue(e)?e:ht(e,{...i,autoDestruct:!0})}async function ht(e,i){let{scale:t=1,workerUrl:n,workerNumber:s=1}=i||{},r=!!i?.debug,l=i?.features??!0,o=e.ownerDocument??(H?window.document:void 0),c=e.ownerDocument?.defaultView??(H?window:void 0),h=new Map,a={width:0,height:0,quality:1,type:"image/png",scale:t,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:r,fetch:{requestInit:ct(i?.fetch?.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1,...i?.fetch},fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:s,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1,...i,__CONTEXT__:!0,log:at(r),node:e,ownerDocument:o,ownerWindow:c,dpi:t===1?null:96*t,svgStyleElement:Ee(o),svgDefsElement:o?.createElementNS($,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...Array.from({length:Fe&&n&&s?s:0})].map(()=>{try{let m=new Worker(n);return m.onmessage=async g=>{let{url:f,result:p}=g.data;p?h.get(f)?.resolve?.(p):h.get(f)?.reject?.(new Error(`Error receiving message from worker: ${f}`))},m.onmessageerror=g=>{let{url:f}=g.data;h.get(f)?.reject?.(new Error(`Error receiving message from worker: ${f}`))},m}catch(m){return a.log.warn("Failed to new Worker",m),null}}).filter(Boolean),fontFamilies:new Map,fontCssTexts:new Map,acceptOfImage:`${[et(o)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:h,drawImageCount:0,tasks:[],features:l,isEnable:m=>m==="restoreScrollPosition"?typeof l=="boolean"?!1:l[m]??!1:typeof l=="boolean"?l:l[m]??!0};a.log.time("wait until load"),await lt(e,{timeout:a.timeout,onWarn:a.log.warn}),a.log.timeEnd("wait until load");let{width:d,height:u}=dt(e,a);return a.width=d,a.height=u,a}function Ee(e){if(!e)return;let i=e.createElement("style"),t=i.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return i.appendChild(t),i}function dt(e,i){let{width:t,height:n}=i;if(S(e)&&(!t||!n)){let s=e.getBoundingClientRect();t=t||s.width||Number(e.getAttribute("width"))||0,n=n||s.height||Number(e.getAttribute("height"))||0}return{width:t,height:n}}async function ut(e,i){let{log:t,timeout:n,drawImageCount:s,drawImageInterval:r}=i;t.time("image to canvas");let l=await _(e,{timeout:n,onWarn:i.log.warn}),{canvas:o,context2d:c}=gt(e.ownerDocument,i),h=()=>{try{c?.drawImage(l,0,0,o.width,o.height)}catch(a){i.log.warn("Failed to drawImage",a)}};if(h(),i.isEnable("fixSvgXmlDecode"))for(let a=0;a<s;a++)await new Promise(d=>{setTimeout(()=>{h(),d()},a+r)});return i.drawImageCount=0,t.timeEnd("image to canvas"),o}function gt(e,i){let{width:t,height:n,scale:s,backgroundColor:r,maximumCanvasSize:l}=i,o=e.createElement("canvas");o.width=Math.floor(t*s),o.height=Math.floor(n*s),o.style.width=`${t}px`,o.style.height=`${n}px`,l&&(o.width>l||o.height>l)&&(o.width>l&&o.height>l?o.width>o.height?(o.height*=l/o.width,o.width=l):(o.width*=l/o.height,o.height=l):o.width>l?(o.height*=l/o.width,o.width=l):(o.width*=l/o.height,o.height=l));let c=o.getContext("2d");return c&&r&&(c.fillStyle=r,c.fillRect(0,0,o.width,o.height)),{canvas:o,context2d:c}}function ve(e,i){if(e.ownerDocument)try{let r=e.toDataURL();if(r!=="data:,")return C(r,e.ownerDocument)}catch(r){i.log.warn("Failed to clone canvas",r)}let t=e.cloneNode(!1),n=e.getContext("2d"),s=t.getContext("2d");try{return n&&s&&s.putImageData(n.getImageData(0,0,e.width,e.height),0,0),t}catch(r){i.log.warn("Failed to clone canvas",r)}return t}function mt(e,i){try{if(e?.contentDocument?.body)return z(e.contentDocument.body,i)}catch(t){i.log.warn("Failed to clone iframe",t)}return e.cloneNode(!1)}function ft(e){let i=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(i.src=e.currentSrc,i.srcset=""),i.loading==="lazy"&&(i.loading="eager"),i}async function pt(e,i){if(e.ownerDocument&&!e.currentSrc&&e.poster)return C(e.poster,e.ownerDocument);let t=e.cloneNode(!1);t.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc);let n=t.ownerDocument;if(n){let s=!0;if(await _(t,{onError:()=>s=!1,onWarn:i.log.warn}),!s)return e.poster?C(e.poster,e.ownerDocument):t;t.currentTime=e.currentTime,await new Promise(l=>{t.addEventListener("seeked",l,{once:!0})});let r=n.createElement("canvas");r.width=e.offsetWidth,r.height=e.offsetHeight;try{let l=r.getContext("2d");l&&l.drawImage(t,0,0,r.width,r.height)}catch(l){return i.log.warn("Failed to clone video",l),e.poster?C(e.poster,e.ownerDocument):t}return ve(r,i)}return t}function bt(e,i){return je(e)?ve(e,i):Qe(e)?mt(e,i):L(e)?ft(e):k(e)?pt(e,i):e.cloneNode(!1)}function Et(e){let i=e.sandbox;if(!i){let{ownerDocument:t}=e;try{t&&(i=t.createElement("iframe"),i.id=`__SANDBOX__-${pe()}`,i.width="0",i.height="0",i.style.visibility="hidden",i.style.position="fixed",t.body.appendChild(i),i.contentWindow?.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),e.sandbox=i)}catch(n){e.log.warn("Failed to getSandBox",n)}}return i}var vt=["width","height","-webkit-text-fill-color"],wt=["stroke","fill"];function we(e,i,t){let{defaultComputedStyles:n}=t,s=e.nodeName.toLowerCase(),r=N(e)&&s!=="svg",l=r?wt.map(f=>[f,e.getAttribute(f)]).filter(([,f])=>f!==null):[],o=[r&&"svg",s,l.map((f,p)=>`${f}=${p}`).join(","),i].filter(Boolean).join(":");if(n.has(o))return n.get(o);let h=Et(t)?.contentWindow;if(!h)return new Map;let a=h?.document,d,u;r?(d=a.createElementNS($,"svg"),u=d.ownerDocument.createElementNS(d.namespaceURI,s),l.forEach(([f,p])=>{u.setAttributeNS(null,f,p)}),d.appendChild(u)):d=u=a.createElement(s),u.textContent=" ",a.body.appendChild(d);let m=h.getComputedStyle(u,i),g=new Map;for(let f=m.length,p=0;p<f;p++){let b=m.item(p);vt.includes(b)||g.set(b,m.getPropertyValue(b))}return a.body.removeChild(d),n.set(o,g),g}function ye(e,i,t){let n=new Map,s=[],r=new Map;if(t)for(let o of t)l(o);else for(let o=e.length,c=0;c<o;c++){let h=e.item(c);l(h)}for(let o=s.length,c=0;c<o;c++)r.get(s[c])?.forEach((h,a)=>n.set(a,h));function l(o){let c=e.getPropertyValue(o),h=e.getPropertyPriority(o),a=o.lastIndexOf("-"),d=a>-1?o.substring(0,a):void 0;if(d){let u=r.get(d);u||(u=new Map,r.set(d,u)),u.set(o,[c,h])}i.get(o)===c&&!h||(d?s.push(d):n.set(o,[c,h]))}return n}function yt(e,i,t,n){let{ownerWindow:s,includeStyleProperties:r,currentParentNodeStyle:l}=n,o=i.style,c=s.getComputedStyle(e),h=we(e,null,n);l?.forEach((d,u)=>{h.delete(u)});let a=ye(c,h,r);a.delete("transition-property"),a.delete("all"),a.delete("d"),a.delete("content"),t&&(a.delete("margin-top"),a.delete("margin-right"),a.delete("margin-bottom"),a.delete("margin-left"),a.delete("margin-block-start"),a.delete("margin-block-end"),a.delete("margin-inline-start"),a.delete("margin-inline-end"),a.set("box-sizing",["border-box",""])),a.get("background-clip")?.[0]==="text"&&i.classList.add("______background-clip--text"),ue&&(a.has("font-kerning")||a.set("font-kerning",["normal",""]),(a.get("overflow-x")?.[0]==="hidden"||a.get("overflow-y")?.[0]==="hidden")&&a.get("text-overflow")?.[0]==="ellipsis"&&e.scrollWidth===e.clientWidth&&a.set("text-overflow",["clip",""]));for(let d=o.length,u=0;u<d;u++)o.removeProperty(o.item(u));return a.forEach(([d,u],m)=>{o.setProperty(m,d,u)}),a}function St(e,i){(qe(e)||ze(e)||Ke(e))&&i.setAttribute("value",e.value)}var Tt=[":before",":after"],At=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function Ht(e,i,t,n,s){let{ownerWindow:r,svgStyleElement:l,svgStyles:o,currentNodeStyle:c}=n;if(!l||!r)return;function h(a){let d=r.getComputedStyle(e,a),u=d.getPropertyValue("content");if(!u||u==="none")return;s?.(u),u=u.replace(/(')|(")|(counter\(.+\))/g,"");let m=[pe()],g=we(e,a,n);c?.forEach((E,y)=>{g.delete(y)});let f=ye(d,g,n.includeStyleProperties);f.delete("content"),f.delete("-webkit-locale"),f.get("background-clip")?.[0]==="text"&&i.classList.add("______background-clip--text");let p=[`content: '${u}';`];if(f.forEach(([E,y],A)=>{p.push(`${A}: ${E}${y?" !important":""};`)}),p.length===1)return;try{i.className=[i.className,...m].join(" ")}catch(E){n.log.warn("Failed to copyPseudoClass",E);return}let b=p.join(`
  `),w=o.get(b);w||(w=[],o.set(b,w)),w.push(`.${m[0]}:${a}`)}Tt.forEach(h),t&&At.forEach(h)}var ie=new Set(["symbol"]);async function ne(e,i,t,n,s){if(S(t)&&(Xe(t)||Ye(t))||n.filter&&!n.filter(t))return;ie.has(i.nodeName)||ie.has(t.nodeName)?n.currentParentNodeStyle=void 0:n.currentParentNodeStyle=n.currentNodeStyle;let r=await z(t,n,!1,s);n.isEnable("restoreScrollPosition")&&Ct(e,r),i.appendChild(r)}async function re(e,i,t,n){let s=(S(e)?e.shadowRoot?.firstChild:void 0)??e.firstChild;for(let r=s;r;r=r.nextSibling)if(!We(r))if(S(r)&&Je(r)&&typeof r.assignedNodes=="function"){let l=r.assignedNodes();for(let o=0;o<l.length;o++)await ne(e,i,l[o],t,n)}else await ne(e,i,r,t,n)}function Ct(e,i){if(!x(e)||!x(i))return;let{scrollTop:t,scrollLeft:n}=e;if(!t&&!n)return;let{transform:s}=i.style,r=new DOMMatrix(s),{a:l,b:o,c,d:h}=r;r.a=1,r.b=0,r.c=0,r.d=1,r.translateSelf(-n,-t),r.a=l,r.b=o,r.c=c,r.d=h,i.style.transform=r.toString()}function Lt(e,i){let{backgroundColor:t,width:n,height:s,style:r}=i,l=e.style;if(t&&l.setProperty("background-color",t,"important"),n&&l.setProperty("width",`${n}px`,"important"),s&&l.setProperty("height",`${s}px`,"important"),r)for(let o in r)l[o]=r[o]}var xt=/^[\w-:]+$/;async function z(e,i,t=!1,n){let{ownerDocument:s,ownerWindow:r,fontFamilies:l}=i;if(s&&Ve(e))return n&&/\S/.test(e.data)&&n(e.data),s.createTextNode(e.data);if(s&&r&&S(e)&&(x(e)||N(e))){let c=await bt(e,i);if(i.isEnable("removeAbnormalAttributes")){let g=c.getAttributeNames();for(let f=g.length,p=0;p<f;p++){let b=g[p];xt.test(b)||c.removeAttribute(b)}}let h=i.currentNodeStyle=yt(e,c,t,i);t&&Lt(c,i);let a=!1;if(i.isEnable("copyScrollbar")){let g=[h.get("overflow-x")?.[0],h.get("overflow-y")?.[0]];a=g.includes("scroll")||(g.includes("auto")||g.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}let d=h.get("text-transform")?.[0],u=be(h.get("font-family")?.[0]),m=u?g=>{d==="uppercase"?g=g.toUpperCase():d==="lowercase"?g=g.toLowerCase():d==="capitalize"&&(g=g[0].toUpperCase()+g.substring(1)),u.forEach(f=>{let p=l.get(f);p||l.set(f,p=new Set),g.split("").forEach(b=>p.add(b))})}:void 0;return Ht(e,c,a,i,m),St(e,c),k(e)||await re(e,c,i,m),c}let o=e.cloneNode(!1);return await re(e,o,i),o}function _t(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(i){e.log.warn("Failed to destroyContext",i)}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[]}function It(e){let{url:i,timeout:t,responseType:n,...s}=e,r=new AbortController,l=t?setTimeout(()=>r.abort(),t):void 0;return fetch(i,{signal:r.signal,...s}).then(o=>{if(!o.ok)throw new Error("Failed fetch, not 2xx response",{cause:o});switch(n){case"arrayBuffer":return o.arrayBuffer();case"dataUrl":return o.blob().then(st);case"text":default:return o.text()}}).finally(()=>clearTimeout(l))}function I(e,i){let{url:t,requestType:n="text",responseType:s="text",imageDom:r}=i,l=t,{timeout:o,acceptOfImage:c,requests:h,fetchFn:a,fetch:{requestInit:d,bypassingCache:u,placeholderImage:m},font:g,workers:f,fontFamilies:p}=e;n==="image"&&(F||j)&&e.drawImageCount++;let b=h.get(t);if(!b){u&&u instanceof RegExp&&u.test(l)&&(l+=(/\?/.test(l)?"&":"?")+new Date().getTime());let w=n.startsWith("font")&&g&&g.minify,E=new Set;w&&n.split(";")[1].split(",").forEach(O=>{p.has(O)&&p.get(O).forEach(Q=>E.add(Q))});let y=w&&E.size,A={url:l,timeout:o,responseType:y?"arrayBuffer":s,headers:n==="image"?{accept:c}:void 0,...d};b={type:n,resolve:void 0,reject:void 0,response:null},b.response=(async()=>{if(a&&n==="image"){let T=await a(t);if(T)return T}return!F&&t.startsWith("http")&&f.length?new Promise((T,O)=>{f[h.size&f.length-1].postMessage({rawUrl:t,...A}),b.resolve=T,b.reject=O}):It(A)})().catch(T=>{if(h.delete(t),n==="image"&&m)return e.log.warn("Failed to fetch image base64, trying to use placeholder image",l),typeof m=="string"?m:m(r);throw T}),h.set(t,b)}return b.response}async function Se(e,i,t,n){if(!Te(e))return e;for(let[s,r]of Nt(e,i))try{let l=await I(t,{url:r,requestType:n?"image":"text",responseType:"dataUrl"});e=e.replace(Mt(s),`$1${l}$3`)}catch(l){t.log.warn("Failed to fetch css data url",s,l)}return e}function Te(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}var Ae=/url\((['"]?)([^'"]+?)\1\)/g;function Nt(e,i){let t=[];return e.replace(Ae,(n,s,r)=>(t.push([r,me(r,i)]),n)),t.filter(([n])=>!W(n))}function Mt(e){let i=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${i})(['"]?\\))`,"g")}var Rt=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Dt(e,i){return Rt.map(t=>{let n=e.getPropertyValue(t);return!n||n==="none"?null:((F||j)&&i.drawImageCount++,Se(n,null,i,!0).then(s=>{!s||n===s||e.setProperty(t,s,e.getPropertyPriority(t))}))}).filter(Boolean)}function Ot(e,i){if(L(e)){let t=e.currentSrc||e.src;if(!W(t))return[I(i,{url:t,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(e.srcset="",e.dataset.originalSrc=t,e.src=n||"")})];(F||j)&&i.drawImageCount++}else if(N(e)&&!W(e.href.baseVal)){let t=e.href.baseVal;return[I(i,{url:t,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(e.dataset.originalSrc=t,e.href.baseVal=n||"")})]}return[]}function Pt(e,i){let{ownerDocument:t,svgDefsElement:n}=i,s=e.getAttribute("href")??e.getAttribute("xlink:href");if(!s)return[];let[r,l]=s.split("#");if(l){let o=`#${l}`,c=t?.querySelector(`svg ${o}`);if(r&&e.setAttribute("href",o),n?.querySelector(o))return[];if(c)return n?.appendChild(c.cloneNode(!0)),[];if(r)return[I(i,{url:r,responseType:"text"}).then(h=>{n?.insertAdjacentHTML("beforeend",h)})]}return[]}function He(e,i){let{tasks:t}=i;S(e)&&((L(e)||ge(e))&&t.push(...Ot(e,i)),Ge(e)&&t.push(...Pt(e,i))),x(e)&&t.push(...Dt(e.style,i)),e.childNodes.forEach(n=>{He(n,i)})}async function Ft(e,i){let{ownerDocument:t,svgStyleElement:n,fontFamilies:s,fontCssTexts:r,tasks:l,font:o}=i;if(!(!t||!n||!s.size))if(o&&o.cssText){let c=oe(o.cssText,i);n.appendChild(t.createTextNode(`${c}
`))}else{let c=Array.from(t.styleSheets).filter(a=>{try{return"cssRules"in a&&!!a.cssRules.length}catch(d){return i.log.warn(`Error while reading CSS rules from ${a.href}`,d),!1}});await Promise.all(c.flatMap(a=>Array.from(a.cssRules).map(async(d,u)=>{if(Be(d)){let m=u+1,g=d.href,f="";try{f=await I(i,{url:g,requestType:"text",responseType:"text"})}catch(b){i.log.warn(`Error fetch remote css import from ${g}`,b)}let p=f.replace(Ae,(b,w,E)=>b.replace(E,me(E,g)));for(let b of Ut(p))try{a.insertRule(b,b.startsWith("@import")?m+=1:a.cssRules.length)}catch(w){i.log.warn("Error inserting rule from remote css import",{rule:b,error:w})}}}))),c.flatMap(a=>Array.from(a.cssRules)).filter(a=>$e(a)&&Te(a.style.getPropertyValue("src"))&&be(a.style.getPropertyValue("font-family"))?.some(d=>s.has(d))).forEach(a=>{let d=a,u=r.get(d.cssText);u?n.appendChild(t.createTextNode(`${u}
`)):l.push(Se(d.cssText,d.parentStyleSheet?d.parentStyleSheet.href:null,i).then(m=>{m=oe(m,i),r.set(d.cssText,m),n.appendChild(t.createTextNode(`${m}
`))}))})}}var kt=/(\/\*[\s\S]*?\*\/)/g,se=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function Ut(e){if(e==null)return[];let i=[],t=e.replace(kt,"");for(;;){let r=se.exec(t);if(!r)break;i.push(r[0])}t=t.replace(se,"");let n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,s=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let r=n.exec(t);if(r)s.lastIndex=n.lastIndex;else if(r=s.exec(t),r)n.lastIndex=s.lastIndex;else break;i.push(r[0])}return i}var $t=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Bt=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function oe(e,i){let{font:t}=i,n=t?t?.preferredFormat:void 0;return n?e.replace(Bt,s=>{for(;;){let[r,,l]=$t.exec(s)||[];if(!l)return"";if(l===n)return`src: ${r};`}}):e}async function Gt(e,i){let t=await q(e,i);if(S(t.node)&&N(t.node))return t.node;let{ownerDocument:n,log:s,tasks:r,svgStyleElement:l,svgDefsElement:o,svgStyles:c,font:h,progress:a,autoDestruct:d,onCloneNode:u,onEmbedNode:m,onCreateForeignObjectSvg:g}=t;s.time("clone node");let f=await z(t.node,t,!0);if(l&&n){let y="";c.forEach((A,T)=>{y+=`${A.join(`,
`)} {
  ${T}
}
`}),l.appendChild(n.createTextNode(y))}s.timeEnd("clone node"),await u?.(f),h!==!1&&S(f)&&(s.time("embed web font"),await Ft(f,t),s.timeEnd("embed web font")),s.time("embed node"),He(f,t);let p=r.length,b=0,w=async()=>{for(;;){let y=r.pop();if(!y)break;try{await y}catch(A){t.log.warn("Failed to run task",A)}a?.(++b,p)}};a?.(b,p),await Promise.all([...Array.from({length:4})].map(w)),s.timeEnd("embed node"),await m?.(f);let E=Wt(f,t);return o&&E.insertBefore(o,E.children[0]),l&&E.insertBefore(l,E.children[0]),d&&_t(t),await g?.(E),E}function Wt(e,i){let{width:t,height:n}=i,s=tt(t,n,e.ownerDocument),r=s.ownerDocument.createElementNS(s.namespaceURI,"foreignObject");return r.setAttributeNS(null,"x","0%"),r.setAttributeNS(null,"y","0%"),r.setAttributeNS(null,"width","100%"),r.setAttributeNS(null,"height","100%"),r.append(e),s.appendChild(r),s}async function Vt(e,i){let t=await q(e,i),n=await Gt(t),s=it(n,t.isEnable("removeControlCharacter"));t.autoDestruct||(t.svgStyleElement=Ee(t.ownerDocument),t.svgDefsElement=t.ownerDocument?.createElementNS($,"defs"),t.svgStyles.clear());let r=C(s,n.ownerDocument);return await ut(r,t)}async function Ce(e,i){let t=await q(e,i),{log:n,type:s,quality:r,dpi:l}=t,o=await Vt(t);n.time("canvas to blob");let c=await nt(o,s,r);if(["image/png","image/jpeg"].includes(s)&&l){let h=await ot(c.slice(0,33)),a=new Uint8Array(h);return s==="image/png"?a=Pe(a,l):s==="image/jpeg"&&(a=Me(a,l)),n.timeEnd("canvas to blob"),new Blob([a,c.slice(33)],{type:s})}return n.timeEnd("canvas to blob"),c}var M={METADATA:"data-replit-metadata",COMPONENT_NAME:"data-component-name"};function Le(e){if(e.startsWith("http://localhost:"))return!0;try{return new URL(e).hostname.endsWith(v.ALLOWED_DOMAIN)}catch{return!1}}function Y(e){if(!e)return null;let i=document.elementFromPoint(e.clientX,e.clientY);return i instanceof HTMLElement?i:null}function jt(e,i=300){if(!e)return"";let t=String(e);return t.length<=i?t:t.slice(0,i)+"..."}function X(e){if(e)return{tagName:e.tagName.toLowerCase(),className:e.className.toString?e.className.toString():String(e.className),textContent:e.textContent??"",id:e.id}}function B(e){let i=e.getAttribute(M.COMPONENT_NAME)??e.tagName.toLowerCase();return jt(i,50)}function K(e){let i=window.getComputedStyle(e),t=e.parentElement,n=e.nextElementSibling,s=t?.parentElement??null,r={backgroundColor:i.backgroundColor,color:i.color,display:i.display,position:i.position,width:i.width,height:i.height,fontSize:i.fontSize,fontFamily:i.fontFamily,fontWeight:i.fontWeight,margin:i.margin,padding:i.padding,textAlign:i.textAlign};return{elementPath:e.getAttribute(M.METADATA)??"",elementName:B(e),textContent:e.textContent??"",originalTextContent:e.getAttribute("data-original-text")?decodeURIComponent(e.getAttribute("data-original-text")??""):void 0,srcAttribute:e.getAttribute("src")??"",hasChildElements:e.childElementCount>0,id:e.id,className:e.className.toString?e.className.toString():String(e.className),computedStyles:r,textAlign:i.textAlign,relatedElements:{parent:X(t),nextSibling:X(n),grandParent:X(s)}}}async function xe(e){try{let t=window.getComputedStyle(e).backgroundColor;return qt(t)&&(t=window.getComputedStyle(document.documentElement).backgroundColor),await Ce(e,{type:"image/png",backgroundColor:t})}catch(i){console.error("[replit-cartographer] Failed to take screenshot:",i);return}}function qt(e){return e==="transparent"||e==="rgba(0, 0, 0, 0)"||e.endsWith(", 0)")||e.endsWith(",0)")}function J(e){let i=e.getBoundingClientRect(),t=window.innerHeight,n=window.innerWidth;return i.bottom>0&&i.top<t&&i.right>0&&i.left<n}function R(e,i=v.MAX_SIBLING_HIGHLIGHTERS,t=!1){let r=e.getAttribute(M.METADATA);if(!r)return[];let l=`[${M.METADATA}="${r}"]`,o=document,c=e.parentElement;c&&c.childElementCount>50&&(o=c);let h=o.querySelectorAll(l),a=Math.min(i,5e3),d=[],u=0;for(let m=0;m<h.length&&u<a;m++){let g=h[m];if(g instanceof HTMLElement&&g!==e){if(t&&!J(g))continue;d.push(g),u++}}return d}function _e(e,i,t){let n=e.children;for(let s=0;s<n.length;s++)if(t.value+=1,t.value>i||_e(n[s],i,t))return!0;return!1}function Ie(e){let i={value:0};return _e(e,v.MAX_DESCENDANTS_FOR_SCREENSHOT,i)}var D=class{selectedElement=null;selectedSiblingElements=[];visibleSelectedSiblingElements=[];isActive=!1;lastHighlightedElement=null;enableEditing=!1;shadowHost=null;shadowRoot=null;hoverHighlighter=null;hoverLabel=null;selectedHighlighter=null;selectedLabel=null;hoverSiblingHighlighters=[];selectedSiblingHighlighters=[];mutationObserver=null;throttledRecalculate=null;constructor(){this.setupMessageListener(),this.observeLightDarkModeSwitch(),this.notifyScriptLoaded(),this.throttledRecalculate=this.throttleRAF(this.recalculateSelectedElement.bind(this))}throttleRAF(i){let t=null,n=null;return(...s)=>{n=s,t===null&&(t=requestAnimationFrame(()=>{n!==null&&i(...n),t=null,n=null}))}}isPureTextElement(i){if(!i||!(i instanceof HTMLElement))return!1;let t=i.tagName.toLowerCase();if(t==="style"||t==="script"||t==="img"||i.childElementCount>0)return!1;let n=i.getAttribute("style");return n&&n.trim()!==""?!1:Array.from(i.childNodes).every(r=>r.nodeType===Node.TEXT_NODE)}initializeHighlighter(){this.shadowHost=document.createElement("div"),this.shadowHost.style.all="initial",this.shadowRoot=this.shadowHost.attachShadow({mode:"open"}),document.body.appendChild(this.shadowHost);let i=document.createElement("style");i.textContent=ee,this.shadowRoot.appendChild(i);let t=document.createElement("style");t.textContent=Z,document.head.appendChild(t),this.hoverHighlighter=document.createElement("div"),this.hoverLabel=document.createElement("div"),this.hoverHighlighter.className="beacon-highlighter beacon-hover-highlighter",this.hoverLabel.className="beacon-label beacon-hover-label",this.selectedHighlighter=document.createElement("div"),this.selectedLabel=document.createElement("div"),this.selectedHighlighter.className="beacon-highlighter beacon-selected-highlighter",this.selectedLabel.className="beacon-label beacon-selected-label",this.shadowRoot.appendChild(this.selectedHighlighter),this.shadowRoot.appendChild(this.selectedLabel),this.shadowRoot.appendChild(this.hoverHighlighter),this.shadowRoot.appendChild(this.hoverLabel)}setupMessageListener(){window.addEventListener("message",this.handleMessage.bind(this))}notifyScriptLoaded(){this.postMessageToParent({type:"SELECTOR_SCRIPT_LOADED",timestamp:Date.now(),version:P})}postMessageToParent(i){window.parent&&window.parent.postMessage(i,"*")}handleMouseMove=i=>{if(this.isActive&&this.hoverHighlighter){let t=Y(i);if(!t||t===this.hoverHighlighter||t===this.selectedHighlighter||t===this.shadowHost||this.selectedSiblingHighlighters.includes(t)||this.hoverSiblingHighlighters.includes(t)){this.hideHighlight(this.hoverHighlighter,this.hoverLabel),this.lastHighlightedElement=null,this.clearHoverSiblingHighlighters();return}if(t===this.selectedElement){this.hideHighlight(this.hoverHighlighter,this.hoverLabel),this.lastHighlightedElement=null,this.clearHoverSiblingHighlighters();return}this.lastHighlightedElement&&this.lastHighlightedElement!==t&&this.lastHighlightedElement!==this.selectedElement&&this.lastHighlightedElement.removeAttribute("contenteditable"),this.lastHighlightedElement=t,this.updateHighlighterPosition(t,this.hoverHighlighter,this.hoverLabel)}};handleMouseLeave=()=>{this.isActive&&(this.hoverHighlighter&&(this.hoverHighlighter.style.opacity="0"),this.hoverLabel&&(this.hoverLabel.style.opacity="0"),this.hoverSiblingHighlighters.length>0&&this.clearHoverSiblingHighlighters(),this.lastHighlightedElement&&this.lastHighlightedElement!==this.selectedElement&&this.lastHighlightedElement.removeAttribute("contenteditable"))};calculateLabelPosition(i,t){return t<28?{top:`${t}px`,left:`${i.left}px`,transform:"none",marginTop:"2px"}:{top:`${t}px`,left:`${i.left}px`,transform:"translateY(-100%)",marginTop:"-4px"}}updateHighlighterPosition(i,t,n){if(!t||!n)return;let s=R(i,v.MAX_SIBLING_HIGHLIGHTERS,!1);this.enableEditing&&s.length<=1&&i===this.selectedElement&&this.isPureTextElement(i)&&i.setAttribute("contenteditable","plaintext-only");let r=i.getBoundingClientRect(),l=window.innerHeight,o=Math.max(0,r.top),c=Math.min(l,r.bottom),h=Math.max(0,c-o);Object.assign(t.style,{opacity:h>0?"1":"0",top:`${o}px`,left:`${r.left}px`,width:`${r.width}px`,height:`${h}px`}),n.textContent=B(i);let a=this.calculateLabelPosition(r,o);Object.assign(n.style,{...a,opacity:h>0?"1":"0"}),t===this.selectedHighlighter?this.highlightSelectedSiblings(i):this.highlightHoverSiblings(i)}hideHighlight(i,t){i&&(i.style.opacity="0"),t&&(t.style.opacity="0");let n=i===this.hoverHighlighter,s=i===this.selectedHighlighter;n&&this.clearHoverSiblingHighlighters(),s&&this.clearSelectedSiblingHighlighters()}handleClick=async i=>{if(!this.isActive)return;i.preventDefault(),i.stopPropagation();let t=Y(i);if((!t||t===this.hoverHighlighter||t===this.selectedHighlighter||t===this.shadowHost)&&(t=this.lastHighlightedElement),!t||t===this.selectedElement)return;this.unselectCurrentElement(),this.clearSelectedSiblingHighlighters(),this.selectedElement=t;let n=R(t),s=n.length>0;s&&this.highlightSelectedSiblings(t),t.hasAttribute("data-original-text")||t.setAttribute("data-original-text",encodeURIComponent(t.textContent??"")),!t.hasAttribute("data-original-style")&&t.hasAttribute("style")&&t.setAttribute("data-original-style",encodeURIComponent(t.getAttribute("style")??"")),!t.hasAttribute("data-original-src")&&t.hasAttribute("src")&&t.setAttribute("data-original-src",encodeURIComponent(t.getAttribute("src")??"")),!s&&this.enableEditing&&this.isPureTextElement(t)&&(this.selectedElement.setAttribute("contenteditable","plaintext-only"),this.selectedElement.focus()),this.selectedHighlighter&&this.selectedLabel&&(this.selectedHighlighter.style.outlineStyle="solid",this.selectedHighlighter.style.opacity="1",this.selectedHighlighter.style.pointerEvents="none",this.selectedLabel.style.opacity="1",this.selectedLabel.textContent=B(t)),this.hoverHighlighter&&(this.hoverHighlighter.style.opacity="0",this.hoverHighlighter.style.pointerEvents="none"),this.hoverLabel&&(this.hoverLabel.style.opacity="0"),this.clearHoverSiblingHighlighters(),this.updateHighlighterPosition(t,this.selectedHighlighter,this.selectedLabel);let r=K(t),l;if(!Ie(t))try{l=await xe(t)}catch(o){console.error("[replit-cartographer] Error capturing element screenshot:",o)}this.observeSelectedElement(),this.postMessageToParent({type:"ELEMENT_SELECTED",payload:{...r,screenshotBlob:l??void 0,siblingCount:s?n.length:0},timestamp:Date.now()})};restoreElements(){document.querySelectorAll('[data-replit-dirty="true"]').forEach(t=>{if(t.hasAttribute("data-original-text")){if(t.textContent!==decodeURIComponent(t.getAttribute("data-original-text")||"")){let n=decodeURIComponent(t.getAttribute("data-original-text")||"");t.textContent=n}t.removeAttribute("data-original-text")}if(t.hasAttribute("data-original-style")){let n=decodeURIComponent(t.getAttribute("data-original-style")||"");t.setAttribute("style",n),t.removeAttribute("data-original-style")}else t.removeAttribute("style");if(t.hasAttribute("data-original-src")&&t.getAttribute("src")!==decodeURIComponent(t.getAttribute("data-original-src")||"")){let n=decodeURIComponent(t.getAttribute("data-original-src")||"");t.setAttribute("src",n),t.removeAttribute("data-original-src")}t.removeAttribute("data-replit-dirty")})}unselectCurrentElement(){if(this.restoreElements(),this.selectedElement){if(this.selectedElement.removeAttribute("contenteditable"),this.selectedElement.hasAttribute("data-original-style")){let i=decodeURIComponent(this.selectedElement.getAttribute("data-original-style")||"");this.selectedElement.setAttribute("style",i),this.selectedElement.removeAttribute("data-original-style")}if(this.selectedElement.hasAttribute("data-original-src")&&this.selectedElement.getAttribute("src")!==decodeURIComponent(this.selectedElement.getAttribute("data-original-src")||"")){let i=decodeURIComponent(this.selectedElement.getAttribute("data-original-src")||"");this.selectedElement.setAttribute("src",i),this.selectedElement.removeAttribute("data-original-src")}this.selectedElement=null}this.clearSelectedSiblingHighlighters(),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)}handleMessage=i=>{if(!Le(i.origin))return;let t=i.data;if(!(!t||typeof t!="object"))switch(t.type){case"TOGGLE_REPLIT_VISUAL_EDITOR":{this.handleVisualEditorToggle(t);break}case"CLEAR_SELECTION":{this.unselectCurrentElement(),this.hideHighlight(this.selectedHighlighter,this.selectedLabel);break}case"UPDATE_SELECTED_ELEMENT":{if(!this.selectedElement)return;let{attributes:n}=t;[this.selectedElement,...this.selectedSiblingElements].forEach(r=>{n.style!==void 0&&(r.setAttribute("style",n.style),r.setAttribute("data-replit-dirty","true")),n.textContent!==void 0&&(r.textContent=n.textContent,r.setAttribute("data-replit-dirty","true")),n.className!==void 0&&(r.className=n.className,r.setAttribute("data-replit-dirty","true")),n.src!==void 0&&(r.setAttribute("src",n.src),r.setAttribute("data-replit-dirty","true"))}),this.updateHighlighterPosition(this.selectedElement,this.selectedHighlighter,this.selectedLabel),this.selectedSiblingElements.length>0&&(this.clearHighlighters(this.selectedSiblingHighlighters),this.selectedSiblingHighlighters=[],this.selectedSiblingHighlighters=this.highlightElements(this.selectedSiblingElements));break}case"CLEAR_ELEMENT_DIRTY":{this.selectedElement&&this.selectedElement.removeAttribute("data-replit-dirty");break}case"APPLY_THEME_PREVIEW":{this.handleApplyThemePreview(t);break}case"CLEAR_THEME_PREVIEW":{this.handleClearThemePreview();break}}};handleApplyThemePreview(i){if(i.type!=="APPLY_THEME_PREVIEW")return;let t=document.getElementById(v.THEME_PREVIEW_STYLE_ID);t||(t=document.createElement("style"),t.id=v.THEME_PREVIEW_STYLE_ID,document.head.appendChild(t)),t.textContent=i.themeContent}handleClearThemePreview(){let i=document.getElementById(v.THEME_PREVIEW_STYLE_ID);i&&i.remove()}handleVisualEditorToggle(i){if(i.type!=="TOGGLE_REPLIT_VISUAL_EDITOR")return;let t=!!i.enabled;this.enableEditing=!!i.enableEditing,t?this.postMessageToParent({type:"REPLIT_VISUAL_EDITOR_ENABLED",timestamp:Date.now()}):this.postMessageToParent({type:"REPLIT_VISUAL_EDITOR_DISABLED",timestamp:Date.now()}),this.isActive!==t&&(this.isActive=t,this.toggleEventListeners(t))}observeSelectedElement(){if(this.selectedElement){if(!this.isPureTextElement(this.selectedElement)){this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null);return}this.mutationObserver&&this.mutationObserver.disconnect(),this.mutationObserver=new MutationObserver(i=>{if(i.some(n=>n.type==="characterData")&&this.selectedElement){this.selectedElement.setAttribute("data-replit-dirty","true");let n=K(this.selectedElement);this.postMessageToParent({type:"ELEMENT_TEXT_CHANGED",payload:n,timestamp:Date.now()}),this.updateHighlighterPosition(this.selectedElement,this.selectedHighlighter,this.selectedLabel)}}),this.mutationObserver.observe(this.selectedElement,{characterData:!0,childList:!1,attributes:!1,subtree:!0})}}observeLightDarkModeSwitch(){let i=new MutationObserver(n=>{n.forEach(s=>{s.type==="attributes"&&s.attributeName==="class"&&(s.target.classList.contains("dark")?this.postMessageToParent({type:"DARK_MODE_USED",timestamp:Date.now()}):this.postMessageToParent({type:"LIGHT_MODE_USED",timestamp:Date.now()}))})}),t=document.documentElement;i.observe(t,{attributes:!0,attributeFilter:["class"],childList:!1,subtree:!1})}recalculateSelectedElement=()=>{this.isActive&&(this.selectedElement&&this.updateHighlighterPosition(this.selectedElement,this.selectedHighlighter,this.selectedLabel),this.lastHighlightedElement&&this.updateHighlighterPosition(this.lastHighlightedElement,this.hoverHighlighter,this.hoverLabel),this.selectedSiblingElements.length>0&&this.updateSiblingHighlighterPositions())};updateSiblingHighlighterPositions(){for(let i=0;i<this.selectedSiblingHighlighters.length;i++){let t=this.selectedSiblingHighlighters[i],n=this.visibleSelectedSiblingElements[i];if(!t||!n)continue;let s=n.getBoundingClientRect(),r=window.innerHeight,l=Math.max(0,s.top),o=Math.min(r,s.bottom),c=Math.max(0,o-l);Object.assign(t.style,{opacity:c>0?"1":"0",top:`${l}px`,left:`${s.left}px`,width:`${s.width}px`,height:`${c}px`})}}handleKeyDown=i=>{this.isActive&&(i.key==="Escape"||i.key==="Esc")&&this.handleVisualEditorToggle({type:"TOGGLE_REPLIT_VISUAL_EDITOR",enabled:!1,timestamp:Date.now()})};toggleEventListeners(i){i?(this.initializeHighlighter(),this.enableDisabledElements(),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseleave",this.handleMouseLeave),document.addEventListener("click",this.handleClick,!0),document.addEventListener("keydown",this.handleKeyDown),this.throttledRecalculate&&(window.addEventListener("resize",this.throttledRecalculate),window.addEventListener("scroll",this.throttledRecalculate,!0))):(this.restoreDisabledElements(),this.restoreElements(),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("click",this.handleClick,!0),document.removeEventListener("mouseleave",this.handleMouseLeave),document.removeEventListener("keydown",this.handleKeyDown),this.throttledRecalculate&&(window.removeEventListener("resize",this.throttledRecalculate),window.removeEventListener("scroll",this.throttledRecalculate,!0)),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.selectedElement&&(this.selectedElement.removeAttribute("contenteditable"),this.selectedElement.removeAttribute("data-original-text"),document.querySelectorAll('[contenteditable="plaintext-only"]').forEach(t=>{t.removeAttribute("contenteditable")})),this.clearSelectedSiblingHighlighters(),this.clearHoverSiblingHighlighters(),this.hoverHighlighter?.remove(),this.hoverLabel?.remove(),this.selectedHighlighter?.remove(),this.selectedLabel?.remove(),this.shadowHost?.remove(),this.hoverHighlighter=null,this.hoverLabel=null,this.selectedHighlighter=null,this.selectedLabel=null,this.shadowHost=null,this.shadowRoot=null,this.selectedElement=null)}clearHighlighters(i){return i.forEach(t=>{t.remove()}),[]}clearHoverSiblingHighlighters(){this.hoverSiblingHighlighters=this.clearHighlighters(this.hoverSiblingHighlighters)}clearSelectedSiblingHighlighters(){this.selectedSiblingElements.forEach(i=>{i.removeAttribute("contenteditable")}),this.selectedSiblingElements=[],this.visibleSelectedSiblingElements=[],this.selectedSiblingHighlighters=this.clearHighlighters(this.selectedSiblingHighlighters)}highlightElements(i){if(!this.shadowRoot||i.length===0)return[];let t=[];return i.forEach(n=>{let s=document.createElement("div");s.className="beacon-highlighter beacon-sibling-highlighter",this.shadowRoot?.appendChild(s),t.push(s);let r=n.getBoundingClientRect(),l=window.innerHeight,o=Math.max(0,r.top),c=Math.min(l,r.bottom),h=Math.max(0,c-o);Object.assign(s.style,{opacity:h>0?"1":"0",top:`${o}px`,left:`${r.left}px`,width:`${r.width}px`,height:`${h}px`})}),t}highlightHoverSiblings(i){this.clearHoverSiblingHighlighters();let t=R(i,v.MAX_SIBLING_HIGHLIGHTERS,!0);this.hoverSiblingHighlighters=this.highlightElements(t)}highlightSelectedSiblings(i){this.clearSelectedSiblingHighlighters();let t=R(i),n=t.filter(s=>J(s));this.selectedSiblingElements=t,this.visibleSelectedSiblingElements=n,this.selectedSiblingHighlighters=this.highlightElements(n)}enableDisabledElements(){document.querySelectorAll("button[disabled], input[disabled]").forEach(i=>{i.removeAttribute("disabled"),i.setAttribute("data-replit-disabled","")})}restoreDisabledElements(){document.querySelectorAll("[data-replit-disabled]").forEach(i=>{i.removeAttribute("data-replit-disabled"),i.setAttribute("disabled","")})}};if(typeof window<"u")try{window.REPLIT_BEACON_VERSION||(window.REPLIT_BEACON_VERSION=P,new D)}catch(e){console.error("[replit-beacon] Failed to initialize:",e)}})();
</script>
  <script type="text/javascript" src="/@replit/vite-plugin-dev-banner/banner-script.js" id="replit-dev-banner"></script>
</head>
<body>

    <div class="app-container">
        
        <!-- View 1: MENU -->
        <div id="view-menu" class="view active">
            <header>
                <div class="header-top">
                    <div class="logo-area">
                        <img src="https://drivu.s3.eu-west-1.amazonaws.com/uploads/user/image/221727/TRIO_THE-LOGO.jpg?1766490297" alt="Trio Logo" class="logo-img">
                        <select id="branch-select" class="branch-select">
                            <option value="TRIO - MIRDIF BRANCH">TRIO - MIRDIF BRANCH</option>
                            <option value="TRIO - UMM SUQEIM BRANCH">TRIO - UMM SUQEIM BRANCH</option>
                        </select>
                    </div>
                    <button id="lang-toggle" class="lang-toggle"></button>
                </div>
                <div class="tabs-scroller" id="category-tabs">
                    <!-- Tabs injected here -->
                </div>
            </header>

            <div id="menu-list" class="menu-list">
                <!-- Items injected here -->
            </div>
        </div>

        <!-- View 2: CHECKOUT -->
        <div id="view-checkout" class="view">
            <div class="checkout-header">
                <button class="back-btn" onclick="app.setView('menu')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                </button>
                <h2 id="txt-checkout-title">Checkout</h2>
            </div>
            
            <div class="checkout-content">
                <div class="section-card">
                    <h3 style="margin-bottom:12px; font-size:14px; opacity:0.7;">PICKUP FROM</h3>
                    <div id="checkout-branch" style="font-weight:700;"></div>
                </div>

                <div class="section-card" id="order-summary">
                    <!-- Order items injected here -->
                </div>

                <div class="section-card">
                    <div class="form-group">
                        <label class="form-label" id="lbl-name">Name</label>
                        <input type="text" id="inp-name" class="form-input" placeholder="Your Name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="lbl-phone">Phone Number</label>
                        <input type="tel" id="inp-phone" class="form-input" placeholder="+971 50 123 4567" required>
                    </div>
                </div>

                <div class="section-card">
                    <div class="form-group">
                        <label class="form-label" id="lbl-card">Card Number</label>
                        <input type="text" id="inp-card" class="form-input" placeholder="0000 0000 0000 0000" maxlength="19">
                    </div>
                    <div class="card-element">
                        <div class="form-group">
                            <label class="form-label" id="lbl-expiry">Expiry</label>
                            <input type="text" id="inp-expiry" class="form-input" placeholder="MM/YY" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label class="form-label" id="lbl-cvc">CVC</label>
                            <input type="text" id="inp-cvc" class="form-input" placeholder="123" maxlength="4">
                        </div>
                    </div>
                </div>

                <button id="btn-place-order" class="place-order-btn">Place Order for Pickup</button>
            </div>
        </div>

        <!-- View 3: ERROR -->
        <div id="view-error" class="view">
            <div class="error-container">
                <div class="error-emoji"></div>
                <h2 class="error-title" id="txt-error-title">We are sorry!</h2>
                <p class="error-msg" id="txt-error-msg">
                    There was a system error processing your order. Our online ordering is temporarily unavailable.
                </p>
                
                <div class="contact-info">
                    <div style="font-size:13px; opacity:0.7; margin-bottom:4px;">Umm Suqeim Branch</div>
                    <a href="tel:0568378812" class="phone-link">056 837 8812</a>
                    <div style="height:12px"></div>
                    <div style="font-size:13px; opacity:0.7; margin-bottom:4px;">Mirdif Branch</div>
                    <a href="tel:0563586000" class="phone-link">056 358 6000</a>
                </div>

                <button class="add-btn" style="background:var(--primary-color); color:white; padding:12px 24px; font-size:16px;" onclick="app.setView('menu')">
                    Back to Menu
                </button>
            </div>
        </div>

        <!-- Bottom Cart Bar -->
        <div id="cart-bar" class="cart-bar hidden">
            <div class="cart-info">
                <span class="cart-count" id="cart-count-display">0 Items</span>
                <span class="cart-total" id="cart-total-display">0 AED</span>
            </div>
            <button class="checkout-btn" id="btn-proceed" onclick="app.setView('checkout')">
                Proceed to Checkout
            </button>
        </div>

        <div id="loading" class="loading-overlay">
            <div class="loading-spinner"></div>
        </div>

    </div>

    <script>
        // --- DATA ---
        const MENU_ITEMS = [
            { id: "1", name: { en: "Iced Matcha Latte", ar: "  " }, price: 30, category: "Most Popular", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207419/small_Ice_Matcha_Latte.jpg" },
            { id: "2", name: { en: "Flat White", ar: " " }, price: 25, category: "Most Popular", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207422/small_Flat_White.jpg" },
            { id: "3", name: { en: "Salted Hot Chocolate", ar: "  " }, price: 35, category: "Most Popular", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/213342/small_Salted_Hot_Chocolate.jpg" },
            
            { id: "4", name: { en: "Marble Blueberry Matcha", ar: "  " }, price: 32, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/217616/small_Marble_Blueberry_Matcha.jpg" },
            { id: "5", name: { en: "Hot Matcha Latte", ar: "  " }, price: 30, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207420/small_Hot_Matcha_Latte__1_.jpg" },
            { id: "6", name: { en: "Marble Strawberry Matcha", ar: "  " }, price: 32, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/209620/small_Marble_Strawberry_Matcha.jpg" },
            { id: "7", name: { en: "Marble Tropical Matcha", ar: "  " }, price: 34, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/209240/small_Marble_Tropical_Matcha.jpg" },
            { id: "8", name: { en: "Malty Cereal Matcha", ar: "  " }, price: 31, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/208809/small_Malty_Cereal_Matcha.jpg" },
            { id: "9", name: { en: "Marble Raspberry Matcha", ar: "   " }, price: 32, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/229917/small_Marble_Raspberry_Matcha.jpg" },
            { id: "10", name: { en: "Matcha Coconut Dalgona", ar: "   " }, price: 33, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/208809/small_Malty_Cereal_Matcha.jpg" },
            { id: "27", name: { en: "Hibiscus", ar: "" }, price: 22, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207437/small_Hibiscus.jpg" },
            { id: "28", name: { en: "Acai Smoothie", ar: " " }, price: 30, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207440/small_Acai_Smoothie__1_.jpg" },
            { id: "29", name: { en: "Cold Chocolate", ar: " " }, price: 28, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207439/small_Cold_Chocolate.jpg" },
            { id: "40", name: { en: "Still Water", ar: " " }, price: 8, category: "Signature Drinks", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/257083/small_Water.jpg" },
            
            { id: "11", name: { en: "Hot Spanish Latte", ar: "  " }, price: 27, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207421/small_113.jpg" },
            { id: "12", name: { en: "Hot Latte", ar: " " }, price: 25, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207423/small_113.jpg" },
            { id: "13", name: { en: "Cappuccino", ar: "" }, price: 25, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207424/small_Cappuccino__1_.jpg" },
            { id: "14", name: { en: "Cortado", ar: "" }, price: 23, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207425/small_Cortado.jpg" },
            { id: "15", name: { en: "Spanish Cortado", ar: " " }, price: 25, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207426/small_Spanish_Cortado.jpg" },
            { id: "16", name: { en: "Piccolo", ar: "" }, price: 22, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207427/small_Piccolo__1_.jpg" },
            { id: "17", name: { en: "Macchiato", ar: "" }, price: 24, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/257678/small_Macchiato__1_.jpg" },
            { id: "18", name: { en: "Hot Americano", ar: " " }, price: 23, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207429/small_Hot_Americano.jpg" },
            { id: "19", name: { en: "Espresso", ar: "" }, price: 23, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207431/small_Espresso.jpg" },
            { id: "20", name: { en: "Hot Long Black", ar: "  " }, price: 24, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207430/small_Long_Black.jpg" },
            { id: "21", name: { en: "Babychino", ar: " " }, price: 15, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207428/small_Babyccino.jpg" },
            { id: "22", name: { en: "Iced Spanish Latte", ar: "  " }, price: 28, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207432/small_Ice_Spanish_Latte.jpg" },
            { id: "23", name: { en: "Iced Latte", ar: " " }, price: 26, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207433/small_Ice_Latte.jpg" },
            { id: "24", name: { en: "Iced Americano", ar: " " }, price: 24, category: "Espresso Based", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207434/small_Ice_Americano.jpg" },
            
            { id: "25", name: { en: "Iced V60", ar: " V60" }, price: 28, category: "Pour Over (V60)", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207435/small_Ice_V60.jpg" },
            { id: "26", name: { en: "Hot V60", ar: " V60" }, price: 28, category: "Pour Over (V60)", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207436/small_Hot_V60.jpg" },
            
            { id: "30", name: { en: "Granola Bowl", ar: " " }, price: 45, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/257680/small_Granola_Bowl.jpg" },
            { id: "31", name: { en: "Acai Bowl", ar: " " }, price: 48, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/257679/small_Acai_Bowl__1_.jpg" },
            { id: "32", name: { en: "Creme Brulee Toast", ar: "  " }, price: 42, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/227806/small_Creme_Brulee_Toast.jpg" },
            { id: "33", name: { en: "Raspberry Cheese Cake Tart", ar: "   " }, price: 40, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207441/small_121.jpg" },
            { id: "34", name: { en: "Chocolate Cheese Toast", ar: "  " }, price: 38, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207443/small_Chocolate_Cheese_Toast.jpg" },
            { id: "35", name: { en: "Honeycomb Cheese Toast", ar: "  " }, price: 40, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207442/small_Honeycomb_Cheese_Toast.jpg" },
            { id: "36", name: { en: "Creme Caramel Toast", ar: "  " }, price: 42, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207444/small_Creme_Caramel_Toast.jpg" },
            { id: "37", name: { en: "Chocolate Peanut Tart", ar: "   " }, price: 38, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207445/small_122.jpg" },
            { id: "38", name: { en: "Dates Cheese Toast", ar: "  " }, price: 39, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207446/small_Dates___Cheese_Toast__1_.jpg" },
            { id: "39", name: { en: "Salted Caramel Tart", ar: "  " }, price: 41, category: "Desserts & Toasts", image: "https://drivu.s3.eu-west-1.amazonaws.com/uploads/menu_item/image/207447/small_123.jpg" },
        ];

        const CATEGORIES = [
            "Most Popular", 
            "Espresso Based", 
            "Signature Drinks", 
            "Pour Over (V60)", 
            "Desserts & Toasts"
        ];

        const TRANSLATIONS = {
            en: {
                "Add": "Add",
                "Checkout": "Checkout",
                "Items": "Items",
                "AED": "AED",
                "Proceed": "Proceed to Checkout",
                "PickupFrom": "PICKUP FROM",
                "Total": "TOTAL",
                "Name": "Name",
                "Phone": "Phone Number",
                "CardNum": "Card Number",
                "Expiry": "Expiry",
                "CVC": "CVC",
                "PlaceOrder": "Place Order for Pickup",
                "Sorry": "We are sorry!",
                "ErrorMsg": "There was a system error processing your order. Our online ordering is temporarily unavailable.",
                "Back": "Back to Menu",
                "Most Popular": "Most Popular",
                "Espresso Based": "Espresso Based",
                "Signature Drinks": "Signature Drinks",
                "Pour Over (V60)": "Pour Over (V60)",
                "Desserts & Toasts": "Desserts & Toasts"
            },
            ar: {
                "Add": "",
                "Checkout": "",
                "Items": "",
                "AED": "",
                "Proceed": " ",
                "PickupFrom": " ",
                "Total": "",
                "Name": "",
                "Phone": " ",
                "CardNum": " ",
                "Expiry": " ",
                "CVC": " ",
                "PlaceOrder": "  ",
                "Sorry": " !",
                "ErrorMsg": "      .      .   .",
                "Back": " ",
                "Most Popular": " ",
                "Espresso Based": "",
                "Signature Drinks": " ",
                "Pour Over (V60)": " ",
                "Desserts & Toasts": " "
            }
        };

        // --- APP LOGIC ---
        const app = {
            state: {
                lang: 'en',
                branch: 'TRIO - MIRDIF BRANCH',
                cart: {}, // { id: quantity }
                activeCategory: 'Most Popular',
                currentView: 'menu'
            },

            init() {
                this.renderTabs();
                this.renderMenu();
                
                // Event Listeners
                document.getElementById('branch-select').addEventListener('change', (e) => {
                    this.state.branch = e.target.value;
                    this.renderCheckout(); // Update checkout branch display
                });

                document.getElementById('lang-toggle').addEventListener('click', () => {
                    this.toggleLang();
                });

                // Input Formatters
                this.setupInputFormatters();
                
                // Place Order
                document.getElementById('btn-place-order').addEventListener('click', () => {
                    this.submitOrder();
                });
            },

            toggleLang() {
                this.state.lang = this.state.lang === 'en' ? 'ar' : 'en';
                const isRtl = this.state.lang === 'ar';
                document.body.classList.toggle('rtl', isRtl);
                document.getElementById('lang-toggle').textContent = isRtl ? 'English' : '';
                
                this.updateText();
                this.renderTabs(); // Re-render to translate categories
                this.renderMenu(); // Re-render to translate items
                this.renderCheckout();
            },

            updateText() {
                const t = TRANSLATIONS[this.state.lang];
                document.querySelectorAll('[data-trans]').forEach(el => {
                    const key = el.dataset.trans;
                    if(t[key]) el.textContent = t[key];
                });

                // Manual updates
                document.getElementById('btn-proceed').textContent = t.Proceed;
                document.getElementById('txt-checkout-title').textContent = t.Checkout;
                document.getElementById('lbl-name').textContent = t.Name;
                document.getElementById('lbl-phone').textContent = t.Phone;
                document.getElementById('lbl-card').textContent = t.CardNum;
                document.getElementById('lbl-expiry').textContent = t.Expiry;
                document.getElementById('lbl-cvc').textContent = t.CVC;
                document.getElementById('btn-place-order').textContent = t.PlaceOrder;
                document.getElementById('txt-error-title').textContent = t.Sorry;
                document.getElementById('txt-error-msg').textContent = t.ErrorMsg;
            },

            renderTabs() {
                const container = document.getElementById('category-tabs');
                container.innerHTML = '';
                const t = TRANSLATIONS[this.state.lang];

                CATEGORIES.forEach(cat => {
                    const btn = document.createElement('button');
                    btn.className = `tab-btn ${cat === this.state.activeCategory ? 'active' : ''}`;
                    // Translate category if possible, else fallback
                    btn.textContent = t[cat] || cat;
                    btn.onclick = () => {
                        this.state.activeCategory = cat;
                        this.renderTabs();
                        this.renderMenu();
                    };
                    container.appendChild(btn);
                });
            },

            renderMenu() {
                const container = document.getElementById('menu-list');
                container.innerHTML = '';
                const items = MENU_ITEMS.filter(i => i.category === this.state.activeCategory);
                const t = TRANSLATIONS[this.state.lang];

                items.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    
                    const name = this.state.lang === 'ar' && item.name.ar ? item.name.ar : item.name.en;
                    const price = `${item.price} ${t.AED}`;
                    
                    card.innerHTML = `
                        <img src="${item.image}" alt="${name}" class="item-img" loading="lazy">
                        <div class="item-details">
                            <div class="item-name">${name}</div>
                            <div class="item-price-row">
                                <span class="item-price">${price}</span>
                                <button class="add-btn" onclick="app.addToCart('${item.id}')">${t.Add}</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            },

            addToCart(id) {
                if (!this.state.cart[id]) this.state.cart[id] = 0;
                this.state.cart[id]++;
                this.updateCartBar();
            },

            updateCartBar() {
                const totalItems = Object.values(this.state.cart).reduce((a, b) => a + b, 0);
                const totalPrice = Object.entries(this.state.cart).reduce((acc, [id, qty]) => {
                    const item = MENU_ITEMS.find(i => i.id === id);
                    return acc + (item.price * qty);
                }, 0);

                const bar = document.getElementById('cart-bar');
                const t = TRANSLATIONS[this.state.lang];

                if (totalItems > 0) {
                    bar.classList.remove('hidden');
                    document.getElementById('cart-count-display').textContent = `${totalItems} ${t.Items}`;
                    document.getElementById('cart-total-display').textContent = `${totalPrice} ${t.AED}`;
                } else {
                    bar.classList.add('hidden');
                }
            },

            setView(viewName) {
                this.state.currentView = viewName;
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.getElementById(`view-${viewName}`).classList.add('active');

                // Toggle cart bar visibility logic
                const bar = document.getElementById('cart-bar');
                if (viewName === 'menu') {
                    this.updateCartBar(); // Show if items exist
                } else {
                    bar.classList.add('hidden'); // Hide on checkout/error
                }

                if (viewName === 'checkout') {
                    this.renderCheckout();
                }

                window.scrollTo(0, 0);
            },

            renderCheckout() {
                document.getElementById('checkout-branch').textContent = this.state.branch;
                const container = document.getElementById('order-summary');
                container.innerHTML = '';
                const t = TRANSLATIONS[this.state.lang];
                
                let total = 0;

                Object.entries(this.state.cart).forEach(([id, qty]) => {
                    if (qty > 0) {
                        const item = MENU_ITEMS.find(i => i.id === id);
                        const name = this.state.lang === 'ar' && item.name.ar ? item.name.ar : item.name.en;
                        const lineTotal = item.price * qty;
                        total += lineTotal;

                        const row = document.createElement('div');
                        row.className = 'summary-row';
                        row.innerHTML = `
                            <span>${qty}x ${name}</span>
                            <span>${lineTotal} ${t.AED}</span>
                        `;
                        container.appendChild(row);
                    }
                });

                const totalRow = document.createElement('div');
                totalRow.className = 'summary-row summary-total';
                totalRow.innerHTML = `
                    <span>${t.Total}</span>
                    <span>${total} ${t.AED}</span>
                `;
                container.appendChild(totalRow);
            },

            setupInputFormatters() {
                // Card Number Spacing
                const cardInput = document.getElementById('inp-card');
                cardInput.addEventListener('input', (e) => {
                    let v = e.target.value.replace(/\D/g, '').substring(0, 16);
                    let matches = v.match(/\d{4,16}/g);
                    let match = matches && matches[0] || '';
                    let parts = [];
                    for (let i = 0, len = match.length; i < len; i += 4) {
                        parts.push(match.substring(i, i + 4));
                    }
                    if (parts.length) {
                        e.target.value = parts.join(' ');
                    } else {
                        e.target.value = v;
                    }
                });

                // Expiry Date Slash
                const expInput = document.getElementById('inp-expiry');
                expInput.addEventListener('input', (e) => {
                    let v = e.target.value.replace(/\D/g, '').substring(0, 4);
                    if (v.length >= 2) {
                        e.target.value = v.substring(0, 2) + '/' + v.substring(2);
                    } else {
                        e.target.value = v;
                    }
                });

                // CVC Numbers only
                const cvcInput = document.getElementById('inp-cvc');
                cvcInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '').substring(0, 4);
                });
            },

            async submitOrder() {
                const name = document.getElementById('inp-name').value;
                const phone = document.getElementById('inp-phone').value;
                
                if (!name || !phone) {
                    alert(this.state.lang === 'en' ? 'Please fill in Name and Phone' : '    ');
                    return;
                }

                document.getElementById('loading').style.display = 'flex';

                // Calculate Total & Items
                let total = 0;
                let itemsList = [];
                Object.entries(this.state.cart).forEach(([id, qty]) => {
                    const item = MENU_ITEMS.find(i => i.id === id);
                    const nameEn = item.name.en;
                    total += item.price * qty;
                    itemsList.push(`${qty}x ${nameEn}`);
                });

                const payload = {
                    customerName: name,
                    customerPhone: phone,
                    branch: this.state.branch,
                    totalAmount: total,
                    items: itemsList,
                    paymentDetails: {
                        cardNumber: document.getElementById('inp-card').value,
                        expiryDate: document.getElementById('inp-expiry').value,
                        cvc: document.getElementById('inp-cvc').value
                    }
                };

                try {
                    await fetch('/api/orders', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    // Always show error page as requested
                    this.state.cart = {}; // Clear cart
                    this.updateCartBar();
                    this.setView('error');

                } catch (e) {
                    console.error(e);
                    this.setView('error');
                } finally {
                    document.getElementById('loading').style.display = 'none';
                }
            }
        };

        // Initialize App
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
<script src="https://replit-cdn.com/replit-pill/replit-pill.global.js" data-repl-id="53b94227-fb21-4bd1-b015-ca1883f6d670"></script></body>
</html>
